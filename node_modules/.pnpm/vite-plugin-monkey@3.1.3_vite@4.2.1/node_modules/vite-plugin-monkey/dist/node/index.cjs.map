{"version":3,"sources":["../../src/node/index.ts","../../../../node_modules/.pnpm/tsup@6.6.3_ts-node@10.9.1_typescript@4.9.5/node_modules/tsup/assets/cjs_shims.js","../../src/node/cdn.ts","../../src/node/_util.ts","../../src/node/_logger.ts","../../src/node/option.ts","../../src/node/inject_template.ts","../../src/node/plugins/server.ts","../../src/node/open_browser.ts","../../src/node/userscript/greasemonkey.ts","../../src/node/userscript/tampermonkey.ts","../../src/node/userscript/violentmonkey.ts","../../src/node/userscript/index.ts","../../src/node/_lazy.ts","../../src/node/plugins/virtualHtml.ts","../../src/node/plugins/fixViteAsset.ts","../../src/node/plugins/fixViteClient.ts","../../src/node/plugins/autoGrant.ts","../../src/node/plugins/externalGlobals.ts","../../src/node/plugins/externalLoader.ts","../../src/node/plugins/externalResource.ts","../../src/node/plugins/finalBundle.ts","../../src/node/systemjs.ts","../../src/node/util.ts","../../src/node/topLevelAwait.ts","../../src/node/plugins/perview.ts","../../src/node/plugins/collectCss.ts","../../src/node/plugins/redirectClient.ts","../../src/node/plugins/inlinesAsset.ts","../../src/node/plugins/index.ts"],"sourcesContent":["import type { PluginOption } from 'vite';\nimport { resolvedOption } from './option';\nimport monkeyPluginList from './plugins';\nimport type { MonkeyOption } from './types';\nimport type {\n  Format,\n  GreasemonkeyUserScript,\n  MonkeyUserScript,\n  TampermonkeyUserScript,\n  ViolentmonkeyUserScript,\n} from './userscript';\n\nexport * as cdn from './cdn';\nexport * as util from './util';\nexport type {\n  MonkeyUserScript,\n  TampermonkeyUserScript,\n  ViolentmonkeyUserScript,\n  GreasemonkeyUserScript,\n  Format,\n  MonkeyOption,\n};\n\nexport default (pluginOption: MonkeyOption): PluginOption => {\n  const finalPluginOption = resolvedOption(pluginOption);\n\n  const monkeyPlugin: PluginOption = {\n    name: 'monkey:entry',\n    async config(userConfig, { command }) {\n      const isServe = command == 'serve';\n\n      return {\n        resolve: {\n          alias: {\n            [finalPluginOption.clientAlias]: 'vite-plugin-monkey/dist/client',\n          },\n        },\n        define: {\n          'process.env.NODE_ENV':\n            userConfig.define?.['process.env.NODE_ENV'] ??\n            JSON.stringify(\n              userConfig.mode ?? (isServe ? 'development' : 'production'),\n            ),\n        },\n        esbuild: {\n          supported: {\n            'top-level-await': true,\n          },\n        },\n        build: {\n          assetsInlineLimit: Number.MAX_SAFE_INTEGER,\n          chunkSizeWarningLimit: Number.MAX_SAFE_INTEGER,\n          modulePreload: false,\n          assetsDir: './',\n          cssCodeSplit: false,\n          minify: userConfig.build?.minify ?? false,\n          rollupOptions: {\n            // serve pre-bundling need\n            input: finalPluginOption.entry,\n          },\n          sourcemap: false,\n\n          // TODO\n          // sourcemap: sourcemap,\n        },\n      };\n    },\n  };\n\n  return [monkeyPlugin, ...monkeyPluginList.map((m) => m(finalPluginOption))];\n};\n","// Shim globals in cjs bundle\n// There's a weird bug that esbuild will always inject importMetaUrl\n// if we export it as `const importMetaUrl = ... __filename ...`\n// But using a function will not cause this issue\n\nconst getImportMetaUrl = () =>\n  typeof document === 'undefined'\n    ? new URL('file:' + __filename).href\n    : (document.currentScript && document.currentScript.src) ||\n      new URL('main.js', document.baseURI).href\n\nexport const importMetaUrl = /* @__PURE__ */ getImportMetaUrl()\n","import type { Mod2UrlFn2 } from './types';\n\n/**\n * `https://cdn.jsdelivr.net/npm/${name}@${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @param pathname jsdelivr support file combine, normally you don't need set pathname\n * @see https://www.jsdelivr.com/features\n */\nexport const jsdelivr = (\n  exportVarName = '',\n  pathname?: string,\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      if (p) {\n        return `https://cdn.jsdelivr.net/npm/${name}@${version}/${p}`;\n      } else {\n        return `https://cdn.jsdelivr.net/npm/${name}@${version}`;\n      }\n    },\n  ];\n};\n\n/**\n * `https://fastly.jsdelivr.net/npm/${name}@${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @param pathname jsdelivr support file combine, normally you don't need set pathname\n * @see https://www.jsdelivr.com/features\n */\nexport const jsdelivrFastly = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      if (p) {\n        return `https://fastly.jsdelivr.net/npm/${name}@${version}/${p}`;\n      } else {\n        return `https://fastly.jsdelivr.net/npm/${name}@${version}`;\n      }\n    },\n  ];\n};\n\n/**\n * `https://unpkg.com/${name}@${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://unpkg.com/\n */\nexport const unpkg = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      if (p) {\n        return `https://unpkg.com/${name}@${version}/${p}`;\n      } else {\n        return `https://unpkg.com/${name}@${version}`;\n      }\n    },\n  ];\n};\n\n/**\n * `https://lf9-cdn-tos.bytecdntp.com/cdn/expire-10-y/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://cdn.bytedance.com/\n */\nexport const bytecdntp = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://lf9-cdn-tos.bytecdntp.com/cdn/expire-10-y/${name}/${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://cdn.bootcdn.net/ajax/libs/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://www.bootcdn.cn/all/\n */\nexport const bootcdn = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://cdn.bootcdn.net/ajax/libs/${name}/${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://lib.baomitu.com/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://cdn.baomitu.com/\n */\nexport const baomitu = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://lib.baomitu.com/${name}/${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://cdn.staticfile.org/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://staticfile.org/\n */\nexport const staticfile = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://cdn.staticfile.org/${name}/${version}/${p}`;\n    },\n  ];\n};\n/**\n * `https://cdnjs.cloudflare.com/ajax/libs/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @see https://cdnjs.com/libraries\n */\nexport const cdnjs = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://cdnjs.cloudflare.com/ajax/libs/${name}/${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://unpkg.zhimg.com/${name}/${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n * @link https://unpkg.zhimg.com/\n */\nexport const zhimg = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://unpkg.zhimg.com/${name}/${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://npm.elemecdn.com/${name}@${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n */\nexport const elemecdn = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://npm.elemecdn.com/${name}@${version}/${p}`;\n    },\n  ];\n};\n\n/**\n * `https://code.bdstatic.com/npm/${name}@${version}/${pathname}`\n * @param exportVarName cdn-exportVarName or resourceName\n */\nexport const bdstatic = (\n  exportVarName = '',\n  pathname = '',\n): [string, Mod2UrlFn2] => {\n  return [\n    exportVarName,\n    (version, name, _importName = '', resolveName = '') => {\n      const p = pathname || resolveName;\n      return `https://code.bdstatic.com/npm/${name}@${version}/${p}`;\n    },\n  ];\n};\n","import { readFileSync } from 'node:fs';\nimport fs from 'node:fs/promises';\nimport { createRequire } from 'node:module';\nimport path from 'node:path';\nimport { normalizePath, transformWithEsbuild } from 'vite';\nimport { logger } from './_logger';\n\nexport const delay = async (n = 0) => {\n  await new Promise<void>((res) => {\n    setTimeout(res, n);\n  });\n};\n\nconst get_vite_start_time = () => {\n  // @see https://github.com/vitejs/vite/blob/c703a3348adeaad9dc92d805a381866917f2a03b/packages/vite/src/node/server/index.ts#L741\n  const n: unknown = Reflect.get(globalThis, '__vite_start_time') ?? 0;\n  if (typeof n != 'number') {\n    return 0;\n  } else {\n    return n;\n  }\n};\n\nexport const isFirstBoot = (n = 1000) => get_vite_start_time() < n;\n\nexport const GM_keywords = [\n  'GM.addElement',\n  'GM.addStyle',\n  'GM.deleteValue',\n  'GM.getResourceUrl',\n  'GM.getValue',\n  'GM.info',\n  'GM.listValues',\n  'GM.notification',\n  'GM.openInTab',\n  'GM.registerMenuCommand',\n  'GM.setClipboard',\n  'GM.setValue',\n  'GM.xmlHttpRequest',\n  'GM.cookie',\n  'GM_addElement',\n  'GM_addStyle',\n  'GM_addValueChangeListener',\n  'GM_cookie',\n  'GM_deleteValue',\n  'GM_download',\n  'GM_getResourceText',\n  'GM_getResourceURL',\n  'GM_getTab',\n  'GM_getTabs',\n  'GM_getValue',\n  'GM_info',\n  'GM_listValues',\n  'GM_log',\n  'GM_notification',\n  'GM_openInTab',\n  'GM_registerMenuCommand',\n  'GM_removeValueChangeListener',\n  'GM_saveTab',\n  'GM_setClipboard',\n  'GM_setValue',\n  'GM_unregisterMenuCommand',\n  'GM_xmlhttpRequest',\n  'unsafeWindow',\n  'window.close',\n  'window.focus',\n  'window.onurlchange',\n];\ntype RawPackageJson = {\n  name?: string;\n  version?: string;\n  description?: string;\n  license?: string;\n  author?: string | { name: string };\n  homepage?: string;\n  repository?: string | { url?: string };\n  bugs?: string | { url?: string };\n};\ntype PackageJson = {\n  name: string;\n  version: string;\n  description?: string;\n  license?: string;\n  author?: string;\n  homepage?: string;\n  repository?: string;\n  bugs?: string;\n};\n\nexport const projectPkg = (() => {\n  let rawTarget: RawPackageJson = {};\n  try {\n    rawTarget = JSON.parse(\n      readFileSync(path.resolve(process.cwd(), 'package.json'), 'utf-8'),\n    );\n  } catch {\n    rawTarget = {};\n  }\n\n  const target: PackageJson = {\n    name: 'monkey',\n    version: '1.0.0',\n  };\n  Object.entries(rawTarget).forEach(([k, v]) => {\n    if (typeof v == 'string') {\n      Reflect.set(target, k, v);\n    }\n  });\n  if (\n    rawTarget.author instanceof Object &&\n    typeof rawTarget.author?.name == 'string'\n  ) {\n    target.author = rawTarget.author?.name;\n  }\n  if (\n    rawTarget.bugs instanceof Object &&\n    typeof rawTarget.bugs?.url == 'string'\n  ) {\n    target.bugs = rawTarget.bugs?.url;\n  }\n  if (\n    rawTarget.repository instanceof Object &&\n    typeof rawTarget.repository?.url == 'string'\n  ) {\n    const { url } = rawTarget.repository;\n    if (url.startsWith('http')) {\n      target.repository = url;\n    } else if (url.startsWith('git+http')) {\n      target.repository = url.slice(4);\n    }\n  }\n  return target;\n})();\n\nexport const compatResolve = (() => {\n  // see https://github.com/formkit/formkit/blob/c77a28c40bfecb8dbd4dca22f12e980abcaf55d9/packages/vue/package.json#L15\n  // `@formkit/vue/package.json` -> `@formkit/vue/dist/package.json`  will error\n  // I try solve it by resolvePackageJsonFromPath\n  const compatRequire = createRequire(process.cwd() + '/any_filename.js');\n  return (id: string) => {\n    return compatRequire.resolve(id);\n  };\n})();\n\nexport const existFile = async (path: string) => {\n  try {\n    return (await fs.stat(path)).isFile();\n  } catch {\n    return false;\n  }\n};\n\n/**\n * unstable\n */\nconst resolvePackageJsonFromPath = async (name: string) => {\n  const p = normalizePath(process.cwd()).split('/');\n  for (let i = p.length; i > 0; i--) {\n    const p2 = `${p.slice(0, i).join('/')}/node_modules/${name}/package.json`;\n    if (await existFile(p2)) {\n      return p2;\n    }\n  }\n};\n\nexport const getModuleRealInfo = async (importName: string) => {\n  const importName2 = normalizePath(importName.split('?')[0]);\n  const resolveName = normalizePath(compatResolve(importName2)).replace(\n    /.*\\/node_modules\\/[^/]+\\//,\n    '',\n  );\n  let version: string | undefined = undefined;\n  const nameList = importName2.split('/');\n  let pkgName = importName2;\n  while (nameList.length > 0) {\n    pkgName = nameList.join('/');\n    const filePath = await (async () => {\n      const p = await resolvePackageJsonFromPath(pkgName);\n      if (p) {\n        return p;\n      }\n      try {\n        return compatResolve(`${pkgName}/package.json`);\n      } catch {\n        return undefined;\n      }\n    })();\n    if (filePath === undefined || !(await existFile(filePath))) {\n      nameList.pop();\n      continue;\n    }\n    const modulePack: PackageJson = JSON.parse(\n      await fs.readFile(filePath, 'utf-8'),\n    );\n    version = modulePack.version;\n    break;\n  }\n  if (version === undefined) {\n    logger.warn(\n      `not found module ${importName2} version, use ${importName2}@latest`,\n    );\n    pkgName = importName2;\n    version = 'latest';\n  }\n  return { version, name: pkgName, resolveName };\n};\n\nexport const mergeObj = <T, S>(target: T | undefined, source: S) => {\n  if (target === undefined) return { ...source } as T & S;\n  const obj = { ...target };\n  for (const k in source) {\n    // @ts-ignore\n    if (obj[k] === undefined) {\n      // @ts-ignore\n      obj[k] = source[k];\n    }\n  }\n  return obj as T & S;\n};\n\nexport const miniCode = async (code: string, type: 'css' | 'js' = 'js') => {\n  return (\n    await transformWithEsbuild(code, 'any_name.' + type, {\n      minify: true,\n      sourcemap: false,\n      legalComments: 'none',\n    })\n  ).code.trimEnd();\n};\n\nexport const toValidURL = (url: unknown) => {\n  if (typeof url != 'string') return;\n  try {\n    return new URL(url);\n  } catch {}\n};\n\nexport const isTopLevelAwaitAvailableTarget = async (\n  target?: string | string[],\n) => {\n  target = getFinalTarget(target);\n  return transformWithEsbuild(`await 1`, 'any.js', {\n    target,\n    logLevel: 'silent',\n  })\n    .then(() => true)\n    .catch(() => false);\n};\n\n// https://github.com/vitejs/vite/blob/b9511f1ed8e36a618214944c69e2de6504ebcb3c/packages/vite/src/node/constants.ts#L20\nexport const ESBUILD_MODULES_TARGET = [\n  'es2020',\n  'edge88',\n  'firefox78',\n  'chrome87',\n  'safari14',\n];\n\nexport const getFinalTarget = (target?: string | string[]) => {\n  if (target === 'modules') {\n    target = ESBUILD_MODULES_TARGET;\n  }\n  return target;\n};\n\nexport const moduleExportExpressionWrapper = (expression: string) => {\n  let n = 0;\n  let identifier = ``;\n  while (expression.includes(identifier)) {\n    identifier = `_${(n || ``).toString(16)}`;\n    n++;\n  }\n  // https://github.com/lisonge/vite-plugin-monkey/issues/70\n  return `(()=>{const ${identifier}=${expression};('default' in ${identifier})||(${identifier}.default=${identifier});return ${identifier}})()`;\n};\n","import pc from 'picocolors';\n\nexport type Message = string | number | null | undefined;\ntype OutputOptions = {\n  /**\n   * @default false\n   */\n  time?: boolean;\n};\n\nconst log = (tag: string, message: Message, options?: OutputOptions) => {\n  console.log(\n    [\n      (options?.time ?? false) === true\n        ? pc.dim(new Date().toLocaleTimeString())\n        : '',\n      pc.bold(pc.blue(`[${tag}]`)),\n      message,\n    ]\n      .filter((s) => s)\n      .join('\\x20'),\n  );\n};\nconst info = (tag: string, message: Message, options?: OutputOptions) => {\n  log(tag, pc.white(message), options);\n};\nconst warn = (tag: string, message: Message, options?: OutputOptions) => {\n  log(tag, pc.yellow(message), options);\n};\nconst error = (tag: string, message: Message, options?: OutputOptions) => {\n  log(tag, pc.red(message), options);\n};\nexport const createLogger = (tag: string) => ({\n  info: async (message: Message, options?: OutputOptions) => {\n    info(tag, message, options);\n  },\n  warn: async (message: Message, options?: OutputOptions) => {\n    warn(tag, message, options);\n  },\n  error: async (message: Message, options?: OutputOptions) => {\n    error(tag, message, options);\n  },\n});\n\n/**\n * default logger\n */\nexport const logger = createLogger('plugin-monkey');\n\nexport type Logger = ReturnType<typeof createLogger>;\n","import { jsdelivr } from './cdn';\nimport type {\n  FinalMonkeyOption,\n  IArray,\n  IPromise,\n  Mod2UrlFn,\n  MonkeyOption,\n  Pkg2UrlFn,\n  PkgOptions,\n} from './types';\nimport { projectPkg } from './_util';\n\nexport const resolvedOption = (\n  pluginOption: MonkeyOption,\n): FinalMonkeyOption => {\n  const build = pluginOption.build ?? {};\n\n  const { externalResource = {} } = build;\n  const externalResource2: Record<\n    string,\n    {\n      resourceUrl: Pkg2UrlFn;\n      resourceName: Pkg2UrlFn;\n      loader?: (pkgOptions: PkgOptions) => unknown;\n      nodeLoader?: (pkgOptions: PkgOptions) => IPromise<string>;\n    }\n  > = {};\n\n  for (const [k, v] of Object.entries(externalResource)) {\n    if (typeof v == 'string') {\n      externalResource2[k] = {\n        resourceName: () => k,\n        resourceUrl: () => v,\n      };\n    } else if (typeof v == 'function') {\n      externalResource2[k] = {\n        resourceName: () => k,\n        resourceUrl: v,\n      };\n    } else if (v instanceof Array) {\n      let resourceUrl2: Pkg2UrlFn;\n      let resourceName2: Pkg2UrlFn = () => k;\n      const [resourceName, resourceUrl] = v;\n      if (typeof resourceName == 'string') {\n        resourceName2 = (pkg) => resourceName || pkg.importName;\n      } else {\n        resourceName2 = (pkg) =>\n          resourceName(pkg.version, pkg.name, pkg.importName, pkg.resolveName);\n      }\n      if (typeof resourceUrl == 'string') {\n        resourceUrl2 = () => resourceUrl;\n      } else {\n        resourceUrl2 = (pkg) =>\n          resourceUrl(pkg.version, pkg.name, pkg.importName, pkg.resolveName);\n      }\n      externalResource2[k] = {\n        resourceName: resourceName2,\n        resourceUrl: resourceUrl2,\n      };\n    } else {\n      const { resourceUrl, loader, nodeLoader, resourceName } = v;\n      let resourceUrl2: Pkg2UrlFn;\n      let resourceName2: Pkg2UrlFn = () => k;\n      let nodeLoader2:\n        | undefined\n        | ((pkgOptions: PkgOptions) => IPromise<string>) = undefined;\n      if (typeof resourceUrl == 'string') {\n        resourceUrl2 = () => resourceUrl;\n      } else {\n        resourceUrl2 = resourceUrl;\n      }\n      if (typeof resourceName == 'string') {\n        resourceName2 = () => resourceName;\n      } else if (typeof resourceName == 'function') {\n        resourceName2 = resourceName;\n      }\n      if (typeof nodeLoader == 'function') {\n        nodeLoader2 = nodeLoader;\n      } else if (typeof nodeLoader == 'string') {\n        nodeLoader2 = () => nodeLoader;\n      }\n      externalResource2[k] = {\n        resourceName: resourceName2,\n        resourceUrl: resourceUrl2,\n        loader,\n        nodeLoader: nodeLoader2,\n      };\n    }\n  }\n\n  const server = pluginOption.server ?? {};\n\n  const { prefix } = server;\n  let prefix2: (name: string) => string = (s) => 'server:' + s;\n  if (typeof prefix == 'function') {\n    prefix2 = prefix;\n  } else if (typeof prefix == 'string') {\n    prefix2 = () => prefix;\n  } else if (prefix === false) {\n    prefix2 = (name: string) => name;\n  }\n  const externalGlobals2 = build?.externalGlobals ?? {};\n  const externalGlobals: [string, IArray<string | Mod2UrlFn>][] = [];\n  if (externalGlobals2 instanceof Array) {\n    externalGlobals2.forEach((s) => externalGlobals.push(s));\n  } else {\n    Object.entries(externalGlobals2).forEach((s) => externalGlobals.push(s));\n  }\n\n  let {\n    name = {},\n    description = {},\n    'exclude-match': excludeMatch = [],\n    match = [],\n    exclude = [],\n    include = [],\n    antifeature = [],\n    require = [],\n    connect = [],\n    grant = [],\n    webRequest = [],\n    $extra = [],\n  } = pluginOption.userscript ?? {};\n  if (typeof name == 'string') {\n    name = { '': name };\n  } else if (!('' in name)) {\n    name = { '': projectPkg.name, ...name };\n  }\n  if (typeof description == 'string') {\n    description = {\n      '': description,\n    };\n  } else if (!('' in description) && projectPkg.description) {\n    description = { '': projectPkg.description, ...description };\n  }\n  if (!(excludeMatch instanceof Array)) {\n    excludeMatch = [excludeMatch];\n  }\n  if (!(match instanceof Array)) {\n    match = [match];\n  }\n  if (!(exclude instanceof Array)) {\n    exclude = [exclude];\n  }\n  if (!(include instanceof Array)) {\n    include = [include];\n  }\n  if (!(antifeature instanceof Array)) {\n    antifeature = [antifeature];\n  }\n  if (!(require instanceof Array)) {\n    require = [require];\n  }\n  if (!(connect instanceof Array)) {\n    connect = [connect];\n  }\n  if (!(webRequest instanceof Array)) {\n    webRequest = [webRequest];\n  }\n\n  const grantSet = new Set<string>();\n  if (typeof grant == 'string') {\n    grantSet.add(grant);\n  } else if (grant instanceof Array) {\n    grant.forEach((s) => grantSet.add(s));\n  }\n\n  const extra: [string, ...string[]][] = [];\n  ($extra instanceof Array ? $extra : Object.entries($extra)).forEach(\n    ([k, v]) => {\n      extra.push([k, ...(v instanceof Array ? v : [v])]);\n    },\n  );\n\n  const {\n    icon64,\n    icon64URL,\n    icon,\n    iconURL,\n    namespace = `vite-plugin-monkey`,\n    version = projectPkg.version,\n    author = projectPkg.author ?? 'monkey',\n    copyright,\n    downloadURL,\n    defaulticon,\n    contributionURL,\n    updateURL,\n    supportURL = projectPkg.bugs,\n    homepageURL = projectPkg.homepage,\n    homepage = projectPkg.homepage,\n    website,\n    license = projectPkg.license,\n    incompatible,\n    source = projectPkg.repository,\n    resource = {},\n    noframes = false,\n    'run-at': runAt,\n    'inject-into': injectInto,\n    contributionAmount,\n    compatible,\n    sandbox,\n    unwrap = false,\n  } = pluginOption.userscript ?? {};\n\n  const { fileName = projectPkg.name + '.user.js' } = build;\n  let { metaFileName } = build;\n  if (typeof metaFileName == 'string') {\n    const t = metaFileName;\n    metaFileName = () => t;\n  } else if (metaFileName === true) {\n    metaFileName = () => fileName.replace(/\\.user\\.js$/, '.meta.js');\n  } else if (metaFileName === false) {\n    metaFileName = undefined;\n  }\n\n  const config: FinalMonkeyOption = {\n    userscript: {\n      name,\n      namespace,\n      version,\n      icon64,\n      icon64URL,\n      icon,\n      iconURL,\n      author,\n      copyright,\n      downloadURL,\n      defaulticon,\n      contributionURL,\n      updateURL,\n      supportURL,\n      homepageURL,\n      homepage,\n      website,\n      license,\n      incompatible,\n      source,\n      resource,\n      noframes,\n      'run-at': runAt,\n      'inject-into': injectInto,\n      contributionAmount,\n      compatible,\n      'exclude-match': excludeMatch.map((s) => String(s)),\n      match: match.map((s) => String(s)),\n      include: include.map((s) => String(s)),\n      exclude: exclude.map((s) => String(s)),\n      antifeature,\n      require,\n      connect,\n      description,\n      $extra: extra,\n      grant: grantSet,\n      sandbox,\n      unwrap,\n      webRequest: webRequest.map((w) => JSON.stringify(w)),\n    },\n    clientAlias: pluginOption.clientAlias ?? '$',\n    entry: pluginOption.entry,\n    format: pluginOption.format,\n    server: {\n      mountGmApi: server.mountGmApi ?? false,\n      open:\n        server.open ??\n        (process.platform == 'win32' || process.platform == 'darwin'),\n      prefix: prefix2,\n    },\n    build: {\n      fileName,\n      metaFileName,\n      autoGrant: build.autoGrant ?? true,\n      minifyCss: build.minifyCss ?? true,\n      externalGlobals: externalGlobals,\n      externalResource: externalResource2,\n    },\n    collectGrantSet: new Set(),\n    collectRequireUrls: [],\n    collectResource: {},\n    hasDynamicImport: false,\n    injectCssCode: ``,\n    globalsPkg2VarName: {},\n    requirePkgList: [],\n    systemjs: build.systemjs ?? jsdelivr()[1],\n  };\n  return config;\n};\n","export const fn2string = <T extends (...args: any[]) => any>(\n  fn: T,\n  ...args: Parameters<T>\n) => {\n  return `;(${fn})(...${JSON.stringify(args, undefined, 2)});`;\n};\n\nexport const serverInjectFn = ({ entrySrc = `` }) => {\n  // @ts-ignore\n  window.GM; // must exist, see https://github.com/Tampermonkey/tampermonkey/issues/1567\n\n  // @ts-ignore\n  document.__monkeyWindow = window;\n  console.log(`[vite-plugin-monkey] mount monkeyWindow to document`);\n\n  const entryScript = document.createElement('script');\n  entryScript.type = 'module';\n  entryScript.src = entrySrc;\n  document.head.insertBefore(entryScript, document.head.firstChild);\n  console.log(`[vite-plugin-monkey] mount entry module to document.head`);\n};\n\nexport const cssInjectFn = (css: string) => {\n  const style = document.createElement('style');\n  style.dataset.source = 'vite-plugin-monkey';\n  style.textContent = css;\n  document.head.append(style);\n};\n\nexport const mountGmApiFn = () => {\n  // @ts-ignore\n  const monkeyWindow: Window = document.__monkeyWindow;\n  if (!monkeyWindow) {\n    console.log(`[vite-plugin-monkey] not found monkeyWindow`);\n    return;\n  }\n\n  // @ts-ignore\n  window.unsafeWindow = window;\n  console.log(`[vite-plugin-monkey] mount unsafeWindow to unsafeWindow`);\n\n  const mountedApiList: string[] = [];\n  Object.entries(monkeyWindow)\n    .filter(([k]) => k.startsWith('GM'))\n    .forEach(([k, fn]) => {\n      // @ts-ignore\n      window[k] = fn;\n      mountedApiList.push(k);\n    });\n  console.log(\n    `[vite-plugin-monkey] mount ${mountedApiList.length} GM_api to unsafeWindow`,\n  );\n};\n\nexport const redirectFn = async (url: string) => {\n  const delay = async (n = 0) => {\n    await new Promise<void>((res) => {\n      setTimeout(res, n);\n    });\n  };\n  await delay();\n  const u = new URL(url, location.origin);\n  u.searchParams.set('origin', u.origin);\n  if (window == window.parent) {\n    location.href = u.href;\n    await delay(500);\n    window.close();\n    return;\n  }\n  const style = document.createElement('style');\n  document.body.append(style);\n  style.innerText = /* css */ `\n.App {\n  margin-top: 20vh;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n}\n.App > a {\n  font-size: 32px;\n  text-align: center;\n}\n.App > .copy {\n  margin-top: 20px;\n  padding: 4px;\n  font-size: 15px;\n  border: 2px solid;\n  cursor: pointer;\n  user-select: none;\n}\n.App > .copied {\n  opacity: 0;\n  margin-top: 10px;\n  font-size: 12px;\n  padding: 8px;\n  border-radius: 5px;\n  background-color: black;\n  color: white;\n}\n.App > .copy:active + .copied {\n  opacity: 1;\n}\n.App > .copy:not(:active) + .copied {\n  transition: opacity 750ms;\n}\n`.trim();\n  const div = document.createElement('div');\n  document.body.append(div);\n  div.innerHTML = /* html */ `\n<div class=\"App\">\n  <a target=\"_blank\"></a>\n  <div class=\"copy\">COPY</div>\n  <div class=\"copied\">Copied!</div>\n</div>\n  `.trim();\n  await delay();\n  const a = div.querySelector('a')!;\n  a.href = location.href;\n  a.text = location.href;\n  const copy = document.querySelector<HTMLElement>('.copy')!;\n  copy.addEventListener('click', async () => {\n    await navigator.clipboard.writeText(u.href);\n  });\n};\n","import detectPort from 'detect-port';\nimport { DomUtils, ElementType, parseDocument } from 'htmlparser2';\nimport fs from 'node:fs/promises';\nimport path from 'node:path';\nimport { normalizePath, PluginOption, ResolvedConfig } from 'vite';\nimport { fn2string, mountGmApiFn, serverInjectFn } from '../inject_template';\nimport { openBrowser } from '../open_browser';\nimport type { FinalMonkeyOption } from '../types';\nimport { finalMonkeyOptionToComment } from '../userscript';\nimport { lazy } from '../_lazy';\nimport { logger } from '../_logger';\nimport { existFile, isFirstBoot, toValidURL } from '../_util';\n\nexport const installUserPath = '/__vite-plugin-monkey.install.user.js';\nconst gmApiPath = '/__vite-plugin-monkey.gm.api.js';\nconst entryPath = '/__vite-plugin-monkey.entry.js';\nconst pullPath = '/__vite-plugin-monkey.pull.js';\nconst cacheUserPath = 'node_modules/.vite/__vite-plugin-monkey.cache.user.js';\n\nexport const serverPlugin = (finalOption: FinalMonkeyOption): PluginOption => {\n  let viteConfig: ResolvedConfig;\n  const serverConfig = lazy(() => {\n    let availablePort = 5173;\n    detectPort(availablePort).then((p) => {\n      availablePort = p;\n    });\n    return {\n      get isHttps() {\n        return !!viteConfig.server.https;\n      },\n      get port() {\n        return viteConfig.server.port ?? availablePort;\n      },\n      get host() {\n        if (\n          typeof viteConfig.server.host == 'string' &&\n          viteConfig.server.host != '0.0.0.0'\n        ) {\n          return viteConfig.server.host;\n        }\n        return '127.0.0.1';\n      },\n      get defaultOrigin() {\n        return `${this.isHttps ? 'https' : 'http'}://${this.host}:${this.port}`;\n      },\n      get installUrl() {\n        return new URL(viteConfig.base, this.defaultOrigin).href;\n      },\n    };\n  });\n  return {\n    name: 'monkey:server',\n    apply: 'serve',\n    async config(userConfig) {\n      return {\n        preview: {\n          host: userConfig.preview?.host ?? '127.0.0.1',\n          cors: true,\n        },\n        server: {\n          open: userConfig.server?.open ?? finalOption.server.open,\n          cors: true,\n        },\n      };\n    },\n    async configResolved(resolvedConfig) {\n      viteConfig = resolvedConfig;\n      const { server } = viteConfig;\n      server.host = serverConfig.host;\n      server.port = serverConfig.port;\n      // server.origin = serverConfig.origin;\n      const baseConfig = {\n        host: serverConfig.host,\n        protocol: serverConfig.isHttps ? 'wss' : 'ws',\n      };\n      if (server.hmr === undefined && server.hmr === true) {\n        server.hmr = baseConfig;\n      } else if (server.hmr && typeof server.hmr == 'object') {\n        Object.assign(server.hmr, baseConfig);\n      }\n    },\n    async configureServer(server) {\n      for (const [k, v] of Object.entries(finalOption.userscript.name)) {\n        Reflect.set(\n          finalOption.userscript.name,\n          k,\n          finalOption.server.prefix(v),\n        );\n      }\n\n      // support dev env\n      finalOption.userscript.grant.add('*');\n\n      server.middlewares.use(async (req, res, next) => {\n        let viteHost = req.headers[':authority'] ?? req.headers['host'] ?? [];\n        if (viteHost instanceof Array) {\n          viteHost = viteHost[0];\n        }\n        if (!viteHost) {\n          logger.error('host not found', { time: true });\n          return next();\n        }\n        const viteOrigin = `${\n          serverConfig.isHttps ? 'https' : 'http'\n        }://${viteHost}`;\n\n        const reqUrl = req.url;\n        if (\n          reqUrl &&\n          [installUserPath, entryPath, pullPath, gmApiPath].some((u) =>\n            reqUrl.startsWith(u),\n          )\n        ) {\n          Object.entries({\n            'access-control-allow-origin': '*',\n            'content-type': 'application/javascript',\n          }).forEach(([k, v]) => {\n            res.setHeader(k, v);\n          });\n          const usp = new URLSearchParams(reqUrl.split('?', 2)[1]);\n          let origin = toValidURL(usp.get(`origin`))?.origin ?? viteOrigin;\n\n          if (reqUrl.startsWith(installUserPath)) {\n            const u = new URL(entryPath, origin);\n            res.end(\n              [\n                await finalMonkeyOptionToComment(finalOption),\n                fn2string(serverInjectFn, {\n                  entrySrc: u.href,\n                }),\n                '',\n              ].join('\\n\\n'),\n            );\n          } else if (reqUrl.startsWith(entryPath)) {\n            const htmlText = await server.transformIndexHtml(\n              '/',\n              `<html><head></head></html>`,\n              req.originalUrl,\n            );\n\n            const doc = parseDocument(htmlText);\n            type Element = ReturnType<typeof DomUtils.findAll> extends Array<\n              infer T\n            >\n              ? T\n              : never;\n            const scriptList = DomUtils.getElementsByTagType(\n              ElementType.Script,\n              doc,\n            ) as Element[];\n\n            const entryList: string[] = finalOption.server.mountGmApi\n              ? [gmApiPath]\n              : [];\n            scriptList.forEach((p) => {\n              const src = p.attribs.src ?? '';\n              const textNode = p.firstChild;\n              let text = '';\n              if (textNode?.type == ElementType.Text) {\n                text = textNode.data ?? '';\n              }\n              if (src) {\n                entryList.push(src);\n              } else {\n                const scriptUrl = new URL(origin);\n                scriptUrl.pathname = pullPath;\n                scriptUrl.searchParams.set(\n                  'text',\n                  Buffer.from(text, 'utf-8').toString('base64url'),\n                );\n                entryList.push(scriptUrl.pathname + scriptUrl.search);\n              }\n            });\n\n            let realEntry = finalOption.entry;\n            if (path.isAbsolute(realEntry)) {\n              realEntry = normalizePath(\n                path.relative(viteConfig.root, realEntry),\n              );\n            }\n            const entryUrl = new URL(realEntry, origin);\n            entryList.push(entryUrl.pathname + entryUrl.search);\n            res.end(\n              entryList.map((s) => `import ${JSON.stringify(s)};`).join('\\n'),\n            );\n          } else if (reqUrl.startsWith(pullPath)) {\n            res.end(\n              Buffer.from(usp.get('text') ?? '', 'base64url').toString('utf-8'),\n            );\n          } else if (reqUrl.startsWith(gmApiPath)) {\n            if (finalOption.server.mountGmApi) {\n              res.end(fn2string(mountGmApiFn));\n            } else {\n              res.end('');\n            }\n          }\n          return;\n        }\n\n        next();\n      });\n\n      if (finalOption.server.open) {\n        let cacheComment = '';\n        if (await existFile(cacheUserPath)) {\n          cacheComment = (await fs.readFile(cacheUserPath)).toString('utf-8');\n        } else {\n          await fs.mkdir(path.dirname(cacheUserPath)).catch();\n        }\n        const newComment = [\n          await finalMonkeyOptionToComment(finalOption),\n          `// entry: ${finalOption.entry}`,\n        ].join('\\n');\n        if (!isFirstBoot() && cacheComment != newComment) {\n          openBrowser(serverConfig.installUrl, true, logger);\n          logger.info('reopen, config comment has changed', { time: true });\n        }\n        await fs.writeFile(cacheUserPath, newComment).catch();\n      }\n    },\n  };\n};\n","import spawn from 'cross-spawn';\nimport { execSync } from 'node:child_process';\nimport path from 'node:path';\nimport open from 'open';\nimport colors from 'picocolors';\nimport type { Logger } from './_logger';\nimport { compatResolve } from './_util';\n\n// https://github.com/sindresorhus/open#app\nconst OSX_CHROME = 'google chrome';\n\n/**\n * Reads the BROWSER environment variable and decides what to do with it.\n * Returns true if it opened a browser or ran a node.js script, otherwise false.\n */\nexport function openBrowser(\n  url: string,\n  opt: string | true,\n  logger: Logger,\n): boolean {\n  // The browser executable to open.\n  // See https://github.com/sindresorhus/open#app for documentation.\n  const browser = typeof opt === 'string' ? opt : process.env.BROWSER || '';\n  if (browser.toLowerCase().endsWith('.js')) {\n    return executeNodeScript(browser, url, logger);\n  } else if (browser.toLowerCase() !== 'none') {\n    return startBrowserProcess(browser, url);\n  }\n  return false;\n}\n\nfunction executeNodeScript(scriptPath: string, url: string, logger: Logger) {\n  const extraArgs = process.argv.slice(2);\n  const child = spawn(process.execPath, [scriptPath, ...extraArgs, url], {\n    stdio: 'inherit',\n  });\n  child.on('close', (code: unknown) => {\n    if (code !== 0) {\n      logger.error(\n        colors.red(\n          `\\nThe script specified as BROWSER environment variable failed.\\n\\n${colors.cyan(\n            scriptPath,\n          )} exited with code ${code}.`,\n        ),\n        { time: true },\n      );\n    }\n  });\n  return true;\n}\n\nfunction startBrowserProcess(browser: string | undefined, url: string) {\n  // If we're on OS X, the user hasn't specifically\n  // requested a different browser, we can try opening\n  // Chrome with AppleScript. This lets us reuse an\n  // existing tab when possible instead of creating a new one.\n  const shouldTryOpenChromeWithAppleScript =\n    process.platform === 'darwin' && (browser === '' || browser === OSX_CHROME);\n\n  if (shouldTryOpenChromeWithAppleScript) {\n    try {\n      // Try our best to reuse existing tab\n      // on OS X Google Chrome with AppleScript\n      execSync('ps cax | grep \"Google Chrome\"');\n      execSync('osascript openChrome.applescript \"' + encodeURI(url) + '\"', {\n        cwd: path.dirname(compatResolve('vite/bin/openChrome.applescript')),\n        stdio: 'ignore',\n      });\n      return true;\n    } catch (err) {\n      // Ignore errors\n    }\n  }\n\n  // Another special case: on OS X, check if BROWSER has been set to \"open\".\n  // In this case, instead of passing the string `open` to `open` function (which won't work),\n  // just ignore it (thus ensuring the intended behavior, i.e. opening the system browser):\n  // https://github.com/facebook/create-react-app/pull/1690#issuecomment-283518768\n  if (process.platform === 'darwin' && browser === 'open') {\n    browser = undefined;\n  }\n\n  // Fallback to open\n  // (It will always open new tab)\n  try {\n    const options: open.Options = browser ? { app: { name: browser } } : {};\n    open(url, options).catch(() => {}); // Prevent `unhandledRejection` error.\n    return true;\n  } catch (err) {\n    return false;\n  }\n}\n","import { IArray, LocaleType } from '../types';\n\nexport type GreaseRunAt = 'document-start' | 'document-end' | 'document-idle';\n\nexport type GreaseGrant =\n  | 'GM.info'\n  | 'GM.deleteValue'\n  | 'GM.getValue'\n  | 'GM.listValues'\n  | 'GM.setValue'\n  | 'GM.getResourceUrl'\n  | 'GM.notification'\n  | 'GM.openInTab'\n  | 'GM.registerMenuCommand'\n  | 'GM.setClipboard'\n  | 'GM.xmlHttpRequest'\n  | 'unsafeWindow';\n\nexport const GreaseGrantValueList: GreaseGrant[] = [\n  'GM.info',\n  'GM.deleteValue',\n  'GM.getValue',\n  'GM.listValues',\n  'GM.setValue',\n  'GM.getResourceUrl',\n  'GM.notification',\n  'GM.openInTab',\n  'GM.registerMenuCommand',\n  'GM.setClipboard',\n  'GM.xmlHttpRequest',\n  'unsafeWindow',\n];\n\n/**\n * @see https://wiki.greasespot.net/Metadata_Block\n */\nexport interface GreasemonkeyUserScript {\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40name\n   *\n   */\n  name?: string | LocaleType<string>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40namespace\n   */\n  namespace?: string;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40version\n   *\n   */\n  version?: string;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40description\n   *\n   */\n  description?: string | LocaleType<string>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40icon\n   */\n  icon?: string;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40include\n   */\n  include?: IArray<string | RegExp>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40match\n   */\n  match?: IArray<string | RegExp>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40exclude\n   */\n  exclude?: IArray<string | RegExp>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40require\n   */\n  require?: IArray<string>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40resource\n   */\n  resource?: Record<string, string>;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40noframes\n   */\n  noframes?: boolean;\n}\n","import { WebRequestRule } from '../../shared/types';\nimport { IArray, LocaleType } from '../types';\n\nexport type TamperRunAt =\n  | 'document-start'\n  | 'document-body'\n  | 'document-end'\n  | 'document-idle'\n  | 'context-menu';\n\nexport type TamperGrant =\n  | 'unsafeWindow'\n  | 'window.close'\n  | 'window.focus'\n  | 'window.onurlchange'\n  | 'GM_addStyle'\n  | 'GM_addElement'\n  | 'GM_deleteValue'\n  | 'GM_listValues'\n  | 'GM_addValueChangeListener'\n  | 'GM_removeValueChangeListener'\n  | 'GM_setValue'\n  | 'GM_getValue'\n  | 'GM_log'\n  | 'GM_getResourceText'\n  | 'GM_getResourceURL'\n  | 'GM_registerMenuCommand'\n  | 'GM_unregisterMenuCommand'\n  | 'GM_openInTab'\n  | 'GM_xmlhttpRequest'\n  | 'GM_download'\n  | 'GM_getTab'\n  | 'GM_saveTab'\n  | 'GM_getTabs'\n  | 'GM_notification'\n  | 'GM_setClipboard'\n  | 'GM_info'\n  | 'GM_cookie'\n  | 'GM_webRequest';\n\nexport const TamperGrantValueList: TamperGrant[] = [\n  'unsafeWindow',\n  'window.close',\n  'window.focus',\n  'window.onurlchange',\n  'GM_addStyle',\n  'GM_addElement',\n  'GM_deleteValue',\n  'GM_listValues',\n  'GM_addValueChangeListener',\n  'GM_removeValueChangeListener',\n  'GM_setValue',\n  'GM_getValue',\n  'GM_log',\n  'GM_getResourceText',\n  'GM_getResourceURL',\n  'GM_registerMenuCommand',\n  'GM_unregisterMenuCommand',\n  'GM_openInTab',\n  'GM_xmlhttpRequest',\n  'GM_download',\n  'GM_getTab',\n  'GM_saveTab',\n  'GM_getTabs',\n  'GM_notification',\n  'GM_setClipboard',\n  'GM_info',\n  'GM_cookie',\n  'GM_webRequest',\n];\n\nexport type AntifeatureType = {\n  tag?: string;\n  type: 'ads' | 'tracking' | 'miner';\n  description: string;\n};\n\n/**\n * @see https://www.tampermonkey.net/documentation.php\n */\nexport interface TampermonkeyUserScript {\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:name\n   *\n   */\n  name?: string | LocaleType<string>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:namespace\n   */\n  namespace?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:copyright\n   */\n  copyright?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:version\n   *\n   */\n  version?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:author\n   *\n   */\n  author?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:description\n   *\n   */\n  description?: string | LocaleType<string>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:homepage\n   *\n   */\n  homepage?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:homepage\n   *\n   */\n  homepageURL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:homepage\n   */\n  website?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:homepage\n   */\n  source?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:icon\n   */\n  icon?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:icon\n   */\n  iconURL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:icon\n   */\n  defaulticon?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:icon64\n   */\n  icon64?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:icon64\n   */\n  icon64URL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:updateURL\n   */\n  updateURL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:downloadURL\n   */\n  downloadURL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:supportURL\n   */\n  supportURL?: string;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:include\n   */\n  include?: IArray<string | RegExp>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:match\n   */\n  match?: IArray<string | RegExp>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:exclude\n   */\n  exclude?: IArray<string | RegExp>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:require\n   */\n  require?: IArray<string>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:resource\n   */\n  resource?: Record<string, string>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:connect\n   */\n  connect?: IArray<string>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:sandbox\n   */\n  sandbox?: 'raw' | 'JavaScript' | 'DOM';\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:antifeature\n   */\n  antifeature?: IArray<AntifeatureType>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:noframes\n   */\n  noframes?: boolean;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:webRequest\n   */\n  webRequest?: IArray<WebRequestRule>;\n\n  /**\n   * @see https://www.tampermonkey.net/documentation.php#meta:unwrap\n   */\n  unwrap?: boolean;\n}\n","import { IArray, LocaleType } from '../types';\n\nexport type ViolentRunAt = 'document-end' | 'document-start' | 'document-idle';\nexport type ViolentInjectInto = 'page' | 'content' | 'auto';\n\nexport type ViolentGrant =\n  | 'window.close'\n  | 'window.focus'\n  | 'GM_info'\n  | 'GM_getValue'\n  | 'GM_setValue'\n  | 'GM_deleteValue'\n  | 'GM_listValues'\n  | 'GM_addValueChangeListener'\n  | 'GM_removeValueChangeListener'\n  | 'GM_getResourceText'\n  | 'GM_getResourceURL'\n  | 'GM_addElement'\n  | 'GM_addStyle'\n  | 'GM_openInTab'\n  | 'GM_registerMenuCommand'\n  | 'GM_unregisterMenuCommand'\n  | 'GM_notification'\n  | 'GM_setClipboard'\n  | 'GM_xmlhttpRequest'\n  | 'GM_download'\n  | 'GM.addStyle'\n  | 'GM.addElement'\n  | 'GM.registerMenuCommand'\n  | 'GM.deleteValue'\n  | 'GM.getResourceUrl'\n  | 'GM.getValue'\n  | 'GM.info'\n  | 'GM.listValues'\n  | 'GM.notification'\n  | 'GM.openInTab'\n  | 'GM.setClipboard'\n  | 'GM.setValue'\n  | 'GM.xmlHttpRequest';\n\nexport const ViolentGrantValueList: ViolentGrant[] = [\n  'window.close',\n  'window.focus',\n  'GM_info',\n  'GM_getValue',\n  'GM_setValue',\n  'GM_deleteValue',\n  'GM_listValues',\n  'GM_addValueChangeListener',\n  'GM_removeValueChangeListener',\n  'GM_getResourceText',\n  'GM_getResourceURL',\n  'GM_addElement',\n  'GM_addStyle',\n  'GM_openInTab',\n  'GM_registerMenuCommand',\n  'GM_unregisterMenuCommand',\n  'GM_notification',\n  'GM_setClipboard',\n  'GM_xmlhttpRequest',\n  'GM_download',\n  'GM.addStyle',\n  'GM.addElement',\n  'GM.registerMenuCommand',\n  'GM.deleteValue',\n  'GM.getResourceUrl',\n  'GM.getValue',\n  'GM.info',\n  'GM.listValues',\n  'GM.notification',\n  'GM.openInTab',\n  'GM.setClipboard',\n  'GM.setValue',\n  'GM.xmlHttpRequest',\n];\n\n/**\n * @see https://violentmonkey.github.io/api/metadata-block/\n */\nexport interface ViolentmonkeyUserScript {\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#name\n   *\n   */\n  name?: string | LocaleType<string>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#namespace\n   */\n  namespace?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#version\n   *\n   */\n  version?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#description\n   *\n   */\n  description?: string | LocaleType<string>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#icon\n   */\n  icon?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#downloadurl\n   */\n  downloadURL?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#supporturl\n   */\n  supportURL?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#homepageurl\n   *\n   */\n  homepageURL?: string;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#include--exclude\n   * @see https://violentmonkey.github.io/api/matching/#include--exclude\n   */\n  include?: IArray<string | RegExp>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#match--exclude-match\n   * @see https://violentmonkey.github.io/api/matching/#match--exclude-match\n   */\n  match?: IArray<string | RegExp>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#match--exclude-match\n   * @see https://violentmonkey.github.io/api/matching/#match--exclude-match\n   */\n  'exclude-match'?: IArray<string | RegExp>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#include--exclude\n   * @see https://violentmonkey.github.io/api/matching/#include--exclude\n   */\n  exclude?: IArray<string | RegExp>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#require\n   */\n  require?: IArray<string>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#resource\n   */\n  resource?: Record<string, string>;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#noframes\n   */\n  noframes?: boolean;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#inject-into\n   */\n  'inject-into'?: ViolentInjectInto;\n\n  /**\n   * @see https://violentmonkey.github.io/api/metadata-block/#unwrap\n   */\n  unwrap?: boolean;\n}\n","import type { FinalMonkeyOption, IArray, LocaleType } from '../types';\nimport type { Format } from './common';\nimport type {\n  GreaseGrant,\n  GreasemonkeyUserScript,\n  GreaseRunAt,\n} from './greasemonkey';\nimport { GreaseGrantValueList } from './greasemonkey';\nimport type {\n  AntifeatureType,\n  TamperGrant,\n  TampermonkeyUserScript,\n  TamperRunAt,\n} from './tampermonkey';\nimport { TamperGrantValueList } from './tampermonkey';\nimport type {\n  ViolentGrant,\n  ViolentmonkeyUserScript,\n  ViolentRunAt,\n} from './violentmonkey';\nimport { ViolentGrantValueList, ViolentInjectInto } from './violentmonkey';\n\nexport type {\n  GreasemonkeyUserScript,\n  TampermonkeyUserScript,\n  ViolentmonkeyUserScript,\n  Format,\n};\n\n/**\n * @see https://greasyfork.org/help/meta-keys\n */\ntype GreasyforkUserScript = {\n  /**\n   * @see https://greasyfork.org/help/meta-keys\n   * @default package.json.license\n   */\n  license?: string;\n\n  /**\n   * @see https://greasyfork.org/help/meta-keys\n   */\n  contributionURL?: string;\n\n  /**\n   * @see https://greasyfork.org/help/meta-keys\n   */\n  contributionAmount?: string;\n\n  /**\n   * @see https://greasyfork.org/help/meta-keys\n   */\n  compatible?: string;\n\n  /**\n   * @see https://greasyfork.org/help/meta-keys\n   */\n  incompatible?: string;\n};\n\ntype MergemonkeyUserScript = {\n  /**\n   * @default package.json.name??'monkey'\n   * @default {...{'':package.json.name??'monkey'},...name} // if name is object\n   */\n  name?: string | LocaleType<string>;\n\n  /**\n   * @default 'vite-plugin-monkey'\n   */\n  namespace?: string;\n\n  /**\n   * @default package.json.version??'1.0.0'\n   */\n  version?: string;\n\n  /**\n   * @default package.json.description\n   * @default {...{'':package.json.description},...description} // if description is object\n   */\n  description?: string | LocaleType<string>;\n\n  /**\n   * @default package.json.author??'monkey'\n   */\n  author?: string;\n\n  /**\n   * @default package.json.homepage\n   */\n  homepage?: string;\n\n  /**\n   * @default package.json.homepage\n   */\n  homepageURL?: string;\n\n  /**\n   * @default package.json.repository\n   */\n  source?: string;\n\n  /**\n   * @default package.json.bugs\n   */\n  supportURL?: string;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40run-at\n   *\n   * @see https://www.tampermonkey.net/documentation.php#meta:run_at\n   *\n   * @see https://violentmonkey.github.io/api/metadata-block/#run-at\n   *\n   */\n  'run-at'?: GreaseRunAt | TamperRunAt | ViolentRunAt;\n\n  /**\n   * @see https://wiki.greasespot.net/Metadata_Block#.40grant\n   *\n   * @see https://www.tampermonkey.net/documentation.php#meta:grant\n   *\n   * @see https://violentmonkey.github.io/api/metadata-block/#grant\n   *\n   * if set '\\*', will add all GM_* to UserScript\n   */\n  grant?: IArray<GreaseGrant | TamperGrant | ViolentGrant> | 'none' | '*';\n\n  /**\n   * custom extra meta\n   * @example\n   * [['antifeature', ['miner', 'hello233']]]\n   * // -->\n   * // \\@antifeature  miner     hello233\n   */\n  $extra?: [string, IArray<string>][] | Record<string, IArray<string>>;\n};\n\n/**\n * UserScript, merge metadata from Greasemonkey, Tampermonkey, Violentmonkey, Greasyfork\n */\nexport type MonkeyUserScript = GreasemonkeyUserScript &\n  TampermonkeyUserScript &\n  ViolentmonkeyUserScript &\n  GreasyforkUserScript &\n  MergemonkeyUserScript;\n\nexport type FinalUserScript = {\n  name: LocaleType<string>;\n  namespace: string;\n  version: string;\n  description: LocaleType<string>;\n  icon?: string;\n  include: string[];\n  match: string[];\n  exclude: string[];\n  require: string[];\n  resource: Record<string, string>;\n  noframes: boolean;\n  unwrap: boolean;\n  webRequest: string[];\n\n  author: string;\n  copyright?: string;\n  homepage?: string;\n  homepageURL?: string;\n  website?: string;\n  source?: string;\n  iconURL?: string;\n  defaulticon?: string;\n  icon64?: string;\n  icon64URL?: string;\n  updateURL?: string;\n  downloadURL?: string;\n  supportURL?: string;\n  connect: string[];\n  sandbox?: string;\n  antifeature: AntifeatureType[];\n\n  'exclude-match': string[];\n  'inject-into'?: ViolentInjectInto;\n  'run-at'?: GreaseRunAt | TamperRunAt | ViolentRunAt;\n  grant: Set<string>;\n  $extra: [string, ...string[]][];\n} & GreasyforkUserScript;\n\nexport const finalMonkeyOptionToComment = async ({\n  userscript,\n  format = { align: 2 },\n  collectGrantSet,\n  collectRequireUrls,\n  collectResource,\n}: FinalMonkeyOption): Promise<string> => {\n  let attrList: [string, ...string[]][] = [];\n  const {\n    name,\n    namespace,\n    version,\n    author,\n    description,\n    license,\n    copyright,\n\n    icon,\n    iconURL,\n    icon64,\n    icon64URL,\n    defaulticon,\n\n    homepage,\n    homepageURL,\n    website,\n    source,\n\n    supportURL,\n    downloadURL,\n    updateURL,\n\n    include,\n    match,\n    exclude,\n    require,\n    'exclude-match': excludeMatch,\n\n    'inject-into': injectInto,\n    'run-at': runAt,\n\n    compatible,\n    incompatible,\n\n    antifeature,\n    contributionAmount,\n    contributionURL,\n\n    connect,\n    sandbox,\n    resource,\n    grant,\n    noframes,\n    unwrap,\n    webRequest,\n    $extra,\n  } = userscript;\n  Object.entries({\n    namespace,\n    version,\n    author,\n    license,\n    copyright,\n    icon,\n    iconURL,\n    icon64,\n    icon64URL,\n    defaulticon,\n    homepage,\n    homepageURL,\n    website,\n    source,\n    supportURL,\n    downloadURL,\n    updateURL,\n    'inject-into': injectInto,\n    'run-at': runAt,\n    compatible,\n    incompatible,\n    contributionAmount,\n    contributionURL,\n    sandbox,\n  }).forEach(([k, v]) => {\n    if (typeof v == 'string') {\n      attrList.push([k, v]);\n    }\n  });\n  Object.entries(name).forEach(([k, v]) => {\n    if (k == '') {\n      attrList.push(['name', v]);\n    } else {\n      attrList.push(['name:' + k, v]);\n    }\n  });\n  Object.entries(description).forEach(([k, v]) => {\n    if (k == '') {\n      attrList.push(['description', v]);\n    } else {\n      attrList.push(['description:' + k, v]);\n    }\n  });\n\n  Object.entries({\n    include,\n    match,\n    exclude,\n    'exclude-match': excludeMatch,\n  }).forEach(([k, v]) => {\n    v.forEach((v2) => {\n      attrList.push([k, v2]);\n    });\n  });\n\n  [...require, ...collectRequireUrls].forEach((s) => {\n    attrList.push(['require', s]);\n  });\n\n  Object.entries({ ...resource, ...collectResource }).forEach(([k, v]) => {\n    attrList.push(['resource', k, v]);\n  });\n\n  connect.forEach((s) => {\n    attrList.push(['connect', s]);\n  });\n\n  webRequest.forEach((s) => {\n    attrList.push(['webRequest', s]);\n  });\n\n  if (grant.has('none')) {\n    attrList.push(['grant', 'none']);\n  } else if (grant.has('*')) {\n    new Set([\n      ...GreaseGrantValueList,\n      ...ViolentGrantValueList,\n      ...TamperGrantValueList,\n    ]).forEach((s) => {\n      attrList.push(['grant', s]);\n    });\n  } else {\n    new Set([...Array.from(collectGrantSet.values()).flat(), ...grant]).forEach(\n      (s) => {\n        attrList.push(['grant', s]);\n      },\n    );\n  }\n  antifeature.forEach(({ description, type, tag }) => {\n    attrList.push([\n      tag ? `antifeature:${tag}` : 'antifeature',\n      type,\n      description,\n    ]);\n  });\n  if (noframes) {\n    attrList.push(['noframes']);\n  }\n  if (unwrap) {\n    attrList.push(['unwrap']);\n  }\n  attrList.push(...$extra);\n\n  attrList = defaultSortFormat(attrList);\n\n  let { align = 2 } = format;\n\n  if (align === true) {\n    align = 2;\n  }\n\n  // format\n  if (typeof align == 'number' && Number.isInteger(align) && align >= 1) {\n    const alignN = align;\n\n    const formatKey = (subAttrList: [string, ...string[]][]) => {\n      if (subAttrList.length == 0) return;\n      const maxLen = Math.max(...subAttrList.map((s) => s[1].length));\n      subAttrList.forEach((s) => {\n        s[1] = s[1].padEnd(alignN + maxLen);\n      });\n    };\n\n    formatKey(attrList.filter((s) => s[0] == 'resource'));\n    formatKey(\n      attrList.filter(\n        (s) => s[0] == 'antifeature' || s[0].startsWith('antifeature:'),\n      ),\n    );\n\n    // format all\n    const maxLen = Math.max(...attrList.map((s) => s[0].length));\n    attrList.forEach((s) => {\n      s[0] = s[0].padEnd(alignN + maxLen);\n    });\n  } else if (typeof align == 'function') {\n    attrList = await align(attrList);\n  }\n\n  return [\n    '==UserScript==',\n    ...attrList.map(\n      (attr) =>\n        '@' +\n        attr\n          .map((v) => {\n            return v.endsWith('\\x20') ? v : v + '\\x20';\n          })\n          .join('')\n          .trimEnd(),\n    ),\n    '==/UserScript==',\n  ]\n    .map((s) => '//\\x20' + s)\n    .join('\\n');\n};\n\nconst stringSort = (a: [string, ...string[]], b: [string, ...string[]]) => {\n  const minLen = Math.min(a.length, b.length);\n  for (let i = 0; i < minLen; i++) {\n    if (a[i] > b[i]) {\n      return 1;\n    } else if (a[i] < b[i]) {\n      return -1;\n    }\n  }\n  if (a.length > b.length) {\n    return 1;\n  } else if (a.length < b.length) {\n    return -1;\n  }\n  return 0;\n};\n\nconst defaultSortFormat = (p0: [string, ...string[]][]) => {\n  const filter = (\n    predicate: (value: [string, ...string[]], index: number) => boolean,\n  ): [string, ...string[]][] => {\n    const notMatchList: [string, ...string[]][] = [];\n    const matchList: [string, ...string[]][] = [];\n    p0.forEach((value, index) => {\n      if (!predicate(value, index)) {\n        notMatchList.push(value);\n      } else {\n        matchList.push(value);\n      }\n    });\n    p0 = notMatchList;\n    return matchList;\n  };\n  return [\n    filter(([k]) => k == 'name'),\n    filter(([k]) => k.startsWith('name:')),\n    filter(([k]) => k == 'namespace'),\n    filter(([k]) => k == 'version'),\n    filter(([k]) => k == 'author'),\n    filter(([k]) => k == 'description'),\n    filter(([k]) => k.startsWith('description:')),\n    filter(([k]) => k == 'license'),\n    filter(([k]) => k == 'copyright'),\n\n    filter(([k]) => k == 'icon'),\n    filter(([k]) => k == 'iconURL'),\n    filter(([k]) => k == 'icon64'),\n    filter(([k]) => k == 'icon64URL'),\n    filter(([k]) => k == 'defaulticon'),\n\n    filter(([k]) => k == 'homepage'),\n    filter(([k]) => k == 'homepageURL'),\n    filter(([k]) => k == 'website'),\n    filter(([k]) => k == 'source'),\n\n    filter(([k]) => k == 'supportURL'),\n    filter(([k]) => k == 'downloadURL'),\n    filter(([k]) => k == 'updateURL'),\n\n    filter(([k]) => k == 'include'),\n    filter(([k]) => k == 'match'),\n    filter(([k]) => k == 'exclude'),\n    filter(([k]) => k == 'exclude-match'),\n    filter(([k]) => k == 'webRequest'),\n\n    filter(([k]) => k == 'require'),\n\n    filter(([k]) => k == 'resource').sort(stringSort),\n\n    filter(([k]) => k == 'sandbox'),\n\n    filter(([k]) => k == 'connect'),\n\n    filter(([k]) => k == 'grant').sort(stringSort),\n\n    filter(([k]) => k == 'inject-into'),\n    filter(([k]) => k == 'run-at'),\n\n    filter(([k]) => k == 'compatible'),\n    filter(([k]) => k == 'incompatible'),\n    filter(([k]) => k == 'antifeature').sort(stringSort),\n    filter(([k]) => k.startsWith('antifeature:')).sort(stringSort),\n    filter(([k]) => k == 'contributionAmount'),\n    filter(([k]) => k == 'contributionURL'),\n    filter(([k]) => k == 'noframes'),\n    filter(([k]) => k == 'unwrap'),\n    p0,\n  ].flat(1);\n};\n","type AnyFunction = (...args: any[]) => any;\n\nconst lazyValuePlaceholder = {};\n\n/**\n * lazy side effect by `__PURE__` comment\n */\nexport const lazy = <T extends object>(fn: () => T) => {\n  let temp: T | undefined = undefined;\n  let o = {\n    get k() {\n      if (temp === undefined) {\n        temp = fn();\n      }\n      return temp;\n    },\n  };\n  const wm = lazyValue(() => new WeakMap<AnyFunction, AnyFunction>());\n  return new Proxy(lazyValuePlaceholder as T, {\n    get(_, p, receiver) {\n      const v: unknown = Reflect.get(o.k, p, receiver);\n      if (typeof v == 'function') {\n        const f = v as AnyFunction;\n        let fBind = wm.value.get(f);\n        if (fBind === undefined) {\n          fBind = f.bind(o.k);\n          wm.value.set(f, fBind);\n        }\n        return fBind;\n      }\n      return v;\n    },\n    set(_, p, newValue, receiver) {\n      return Reflect.set(o.k, p, newValue, receiver);\n    },\n    has(_, p) {\n      return Reflect.has(o.k, p);\n    },\n    ownKeys() {\n      return Reflect.ownKeys(o.k);\n    },\n    isExtensible() {\n      return Reflect.isExtensible(o.k);\n    },\n    deleteProperty(_, p) {\n      return Reflect.deleteProperty(o.k, p);\n    },\n    setPrototypeOf(_, v) {\n      return Reflect.setPrototypeOf(o.k, v);\n    },\n    getOwnPropertyDescriptor(_, p) {\n      return Reflect.getOwnPropertyDescriptor(o.k, p);\n    },\n    defineProperty(_, property, attributes) {\n      return Reflect.defineProperty(o.k, property, attributes);\n    },\n    getPrototypeOf() {\n      return Reflect.getPrototypeOf(o.k);\n    },\n    preventExtensions() {\n      return Reflect.preventExtensions(o.k);\n    },\n    apply(_, thisArg, argArray) {\n      // @ts-ignore\n      return Reflect.apply(o.k, thisArg, argArray);\n    },\n    construct(_, argArray, newTarget) {\n      // @ts-ignore\n      return Reflect.construct(o.k, argArray, newTarget);\n    },\n  });\n};\n\nexport const lazyValue = <T>(fn: () => T) => {\n  let temp: T | typeof lazyValuePlaceholder = lazyValuePlaceholder;\n  return {\n    get value() {\n      if (temp === lazyValuePlaceholder) {\n        temp = fn();\n      }\n      return temp as T;\n    },\n  };\n};\n","import type { PluginOption } from 'vite';\nimport { fn2string, redirectFn } from '../inject_template';\nimport type { FinalMonkeyOption } from '../types';\nimport { installUserPath } from './server';\n\nconst htmlText = `\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"UTF-8\" />\n    <link rel=\"icon\" type=\"image/svg+xml\" href=\"https://vitejs.dev/logo.svg\" />\n    <title>Vite</title>\n  </head>\n  <script type=\"module\" data-source=\"vite-plugin-monkey\">\n  ${fn2string(redirectFn, installUserPath).trim()}\n  </script>\n</html>\n`.trimStart();\n\n// https://github.com/vitejs/vite/blob/2401253b9aa487c50edb5ec571d5ba7adc949e27/packages/vite/src/node/server/middlewares/indexHtml.ts#L275\n\nexport const virtualHtmlPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  return {\n    name: 'monkey:virtualHtml',\n    apply: 'serve',\n    configureServer(server) {\n      server.middlewares.use(async (req, res, next) => {\n        const url = req.url || '/';\n        if (['/', '/index.html'].includes(url)) {\n          res.setHeader('content-type', 'text/html');\n          res.setHeader('cache-control', 'no-cache');\n          res.setHeader('access-control-allow-origin', '*');\n          return res.end(htmlText);\n        }\n        next();\n      });\n    },\n  };\n};\n","import { PluginOption, ResolvedConfig } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\n\n// should use import.meta['url'], becase vite will replace import.meta.url to self.location\nconst template = `\nexport default ((()=>{\n  try{\n    return new URL(__VALUE__, import.meta['url']).href\n  }catch(_){\n    return __VALUE__\n  }\n})())\n`.trimStart();\n// https://github.com/vitejs/vite/blob/9c114c5c72a6af87e3330d5573362554b4511265/packages/vite/src/node/plugins/asset.ts#L172\n\n// TODO the relative path of the *.vue file template does not work\n\nexport const fixViteAssetPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  let viteConfig: ResolvedConfig;\n  return {\n    name: 'monkey:fixViteAsset',\n    apply: 'serve',\n    async configResolved(resolvedConfig) {\n      viteConfig = resolvedConfig;\n    },\n    async transform(code, id) {\n      const [_, query = 'url'] = id.split('?', 2);\n      if (\n        (query.split('&').includes('url') || viteConfig.assetsInclude(id)) &&\n        code.match(/^\\s*export\\s+default/)\n      ) {\n        const ast: any = this.parse(code);\n        if (ast.type == 'Program') {\n          const defaultNode = ast.body?.[0];\n          if (defaultNode?.type == 'ExportDefaultDeclaration') {\n            const declarationNode = defaultNode?.declaration;\n            const value = declarationNode?.value;\n            if (\n              declarationNode?.type == 'Literal' &&\n              typeof value == 'string'\n            ) {\n              return template.replace(/__VALUE__/g, JSON.stringify(value));\n            }\n          }\n        }\n      }\n    },\n  };\n};\n","import { PluginOption, transformWithEsbuild } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\n\nexport const fixViteClientPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  return {\n    name: 'monkey:fixViteClient',\n    apply: 'serve',\n    async transform(code, id) {\n      if (id.endsWith('node_modules/vite/dist/client/client.mjs')) {\n        // use import.meta['url'] instead of import.meta.url, because vite will replace import.meta.url to file system path\n        code = code.replace(\n          /__HMR_PROTOCOL__/g,\n          `(__HMR_PROTOCOL__ || ((()=>{const u = new URL(import.meta['url'], location.origin);return u.protocol === 'https:' ? 'wss' : 'ws'})()))`,\n        );\n\n        code = code.replace(\n          /__BASE__/g,\n          `((()=>{const b = __BASE__; const u = new URL(import.meta['url'], location.origin); return b !== '/' ? b : (u.origin+'/');})())`,\n        );\n\n        // work with vite@3\n        // see https://github.com/vitejs/vite/blob/v3.0.0/packages/vite/src/client/client.ts#L302\n        // vite@4 not need\n        // see https://github.com/vitejs/vite/blob/v4.0.0/packages/vite/src/client/client.ts\n        code = code.replace(\n          '`${location.protocol}//${hostAndPath}`',\n          \"`${new URL(import.meta['url'], location.origin).protocol}//${hostAndPath}`\",\n        );\n        return code;\n      }\n    },\n  };\n};\n","import type { PluginOption } from 'vite';\nimport { normalizePath } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\nimport { GM_keywords } from '../_util';\n\nconst GM_keyword_set = Array.from(new Set(GM_keywords));\n\nexport const autoGrantPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  const collectGrantMap = new Map<string, string[]>();\n  return {\n    name: 'monkey:autoGrant',\n    apply: 'build',\n    enforce: 'post',\n    async transform(code, id) {\n      id = normalizePath(id);\n      if (\n        finalOption.build.autoGrant &&\n        !id.endsWith('vite-plugin-monkey/dist/client/index.mjs') &&\n        !id.endsWith('vite-plugin-monkey/dist/native/index.mjs') &&\n        !id.includes('virtual:plugin-monkey-loader')\n      ) {\n        collectGrantMap.set(\n          id,\n          GM_keyword_set.filter((fnName) => code.includes(fnName)),\n        );\n      }\n    },\n    generateBundle() {\n      const idSet = new Set(\n        Array.from(this.getModuleIds()).map((s) => normalizePath(s)),\n      );\n      Array.from(collectGrantMap.keys()).forEach((s) => {\n        if (!idSet.has(s)) {\n          collectGrantMap.delete(s);\n        }\n      });\n      finalOption.collectGrantSet = new Set(\n        Array.from(collectGrantMap.values()).flat(),\n      );\n    },\n  };\n};\n","import { normalizePath, PluginOption } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\nimport { getModuleRealInfo } from '../_util';\n\n// const dynamicImportPrefix = '\\0monkey-dynamic-import:';\n\nexport const externalGlobalsPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  const { globalsPkg2VarName, requirePkgList } = finalOption;\n  return {\n    name: 'monkey:externalGlobals',\n    enforce: 'pre',\n    apply: 'build',\n    async config() {\n      for (const [moduleName, varName2LibUrl] of finalOption.build\n        .externalGlobals) {\n        const { name, version } = await getModuleRealInfo(moduleName);\n\n        if (typeof varName2LibUrl == 'string') {\n          globalsPkg2VarName[moduleName] = varName2LibUrl;\n        } else if (typeof varName2LibUrl == 'function') {\n          globalsPkg2VarName[moduleName] = await varName2LibUrl(\n            version,\n            name,\n            moduleName,\n          );\n        } else if (varName2LibUrl instanceof Array) {\n          const [varName, ...libUrlList] = varName2LibUrl;\n          if (typeof varName == 'string') {\n            globalsPkg2VarName[moduleName] = varName;\n          } else if (typeof varName == 'function') {\n            globalsPkg2VarName[moduleName] = await varName(\n              version,\n              name,\n              moduleName,\n            );\n          }\n          for (const libUrl of libUrlList) {\n            // keep add order\n            if (typeof libUrl == 'string') {\n              requirePkgList.push({ url: libUrl, moduleName });\n            } else if (typeof libUrl == 'function') {\n              requirePkgList.push({\n                url: await libUrl(version, name, moduleName),\n                moduleName,\n              });\n            }\n          }\n        }\n      }\n      return {\n        build: {\n          rollupOptions: {\n            external(source, _importer, _isResolved) {\n              return source in globalsPkg2VarName;\n            },\n            // output: {\n            //   globals: globalsPkg2VarName,\n            //   inlineDynamicImports: true, // see https://rollupjs.org/guide/en/#outputinlinedynamicimports\n            // },\n          },\n        },\n      };\n    },\n\n    // async resolveDynamicImport(specifier, _importer) {\n    //   if (typeof specifier == 'string' && specifier in globalsPkg2VarName) {\n    //     return dynamicImportPrefix + specifier + '\\0';\n    //   }\n    // },\n\n    // async load(id) {\n    //   if (id.startsWith(dynamicImportPrefix) && id.endsWith('\\0')) {\n    //     const rawId = id.slice(dynamicImportPrefix.length, id.length - 1);\n    //     if (rawId in globalsPkg2VarName) {\n    //       return `export {default} from '${rawId}';export * from '${rawId}';`;\n    //     }\n    //   }\n    // },\n\n    async generateBundle() {\n      const usedModIdSet = new Set(\n        Array.from(this.getModuleIds()).map((s) => normalizePath(s)),\n      );\n      // Array.from(usedModIdSet).forEach((id) => {\n      //   if (id.startsWith(dynamicImportPrefix) && id.endsWith('\\0')) {\n      //     usedModIdSet.add(id.slice(dynamicImportPrefix.length, id.length - 1));\n      //   }\n      // });\n      finalOption.collectRequireUrls = requirePkgList\n        .filter((p) => usedModIdSet.has(p.moduleName))\n        .map((p) => p.url);\n    },\n  };\n};\n","import { PluginOption, transformWithEsbuild } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\n\nconst GM_getResourceText = (name: string) => document.title;\nconst GM_getResourceURL = (name: string, isBlobUrl?: boolean) => document.title;\n\nconst cssLoader = (resourceName: string) => {\n  const css = GM_getResourceText(resourceName);\n  const style = document.createElement('style');\n  style.innerText = css;\n  document.head.append(style);\n  return css;\n};\n\nconst jsonLoader = (resourceName: string): unknown =>\n  JSON.parse(GM_getResourceText(resourceName));\n\nconst urlLoader = (resourceName: string, mediaType: string) =>\n  GM_getResourceURL(resourceName, false).replace(\n    /^data:application;base64,/,\n    `data:${mediaType};base64,`,\n  );\n\nconst rawLoader = (resourceName: string) => GM_getResourceText(resourceName);\n\nconst moduleSourceCode = [\n  `export const cssLoader = ${cssLoader}`,\n  `export const jsonLoader = ${jsonLoader}`,\n  `export const urlLoader = ${urlLoader}`,\n  `export const rawLoader = ${rawLoader}`,\n].join(';');\n\nexport const externalLoaderPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  return {\n    name: 'monkey:externalLoader',\n    enforce: 'pre',\n    apply: 'build',\n    async resolveId(id) {\n      if (id == 'virtual:plugin-monkey-loader') {\n        return '\\0' + id;\n      }\n    },\n    async load(id) {\n      if (id == '\\0virtual:plugin-monkey-loader') {\n        return transformWithEsbuild(\n          moduleSourceCode,\n          '/virtual/plugin-monkey-loader/index.js',\n          {\n            minify: true,\n            sourcemap: true,\n            legalComments: 'none',\n          },\n        );\n      }\n    },\n  };\n};\n","import { normalizePath, PluginOption, ResolvedConfig } from 'vite';\nimport type { FinalMonkeyOption, PkgOptions } from '../types';\nimport { getModuleRealInfo, miniCode } from '../_util';\nimport { lookup, mimes } from 'mrmime';\nimport { URLSearchParams } from 'node:url';\n\nconst resourceImportPrefix = '\\0monkey-resource-import:';\n\nexport const externalResourcePlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  const resourceRecord: Record<\n    string,\n    { resourceName: string; resourceUrl: string }\n  > = {};\n  let viteConfig: ResolvedConfig;\n  return {\n    name: 'monkey:externalResource',\n    enforce: 'pre',\n    apply: 'build',\n    configResolved(config) {\n      viteConfig = config;\n    },\n    async resolveId(id) {\n      const { externalResource } = finalOption.build;\n      if (id in externalResource) {\n        return resourceImportPrefix + id + '\\0';\n      }\n      // see https://github.com/vitejs/vite/blob/5d56e421625b408879672a1dd4e774bae3df674f/packages/vite/src/node/plugins/css.ts#L431-L434\n      const [resource, query] = id.split('?', 2);\n      if (resource.endsWith('.css') && query) {\n        const id2 = [\n          resource,\n          '?',\n          query\n            .split('&')\n            .filter((e) => e != 'used')\n            .join(`&`),\n        ].join('');\n        if (id2 in externalResource) {\n          return resourceImportPrefix + id2 + '\\0';\n        }\n      }\n    },\n    async load(id) {\n      if (id.startsWith(resourceImportPrefix) && id.endsWith('\\0')) {\n        const { externalResource } = finalOption.build;\n        const importName = id.substring(\n          resourceImportPrefix.length,\n          id.length - 1,\n        );\n        if (!(importName in externalResource)) {\n          return;\n        }\n        const pkg = await getModuleRealInfo(importName);\n        const {\n          resourceName: resourceNameFn,\n          resourceUrl: resourceUrlFn,\n          loader,\n          nodeLoader,\n        } = externalResource[importName];\n        const resourceName = await resourceNameFn({ ...pkg, importName });\n        const resourceUrl = await resourceUrlFn({ ...pkg, importName });\n        resourceRecord[importName] = {\n          resourceName,\n          resourceUrl,\n        };\n\n        if (nodeLoader) {\n          return miniCode(\n            await nodeLoader({\n              ...pkg,\n              resourceName,\n              resourceUrl,\n              importName,\n            }),\n          );\n        } else if (loader) {\n          let fnText: string;\n          if (\n            loader.prototype && // not arrow function\n            loader.name.length > 0 &&\n            loader.name != 'function' // not anonymous function\n          ) {\n            if (Reflect.get(loader, Symbol.toStringTag) == 'AsyncFunction') {\n              fnText = loader\n                .toString()\n                .replace(/^[\\s\\S]+?\\(/, 'async function(');\n            } else {\n              fnText = loader.toString().replace(/^[\\s\\S]+?\\(/, 'function(');\n            }\n          } else {\n            fnText = loader.toString();\n          }\n          return miniCode(\n            `export default (${fnText})(${JSON.stringify({\n              resourceUrl,\n              importName,\n              ...pkg,\n            } as PkgOptions)})`,\n          );\n        }\n\n        let moduleCode: string | undefined = undefined;\n        const [resource, query] = importName.split('?', 2);\n        const ext = resource.split('.').pop()!;\n        const mimeType = lookup(ext) ?? 'application/octet-stream';\n        const suffixSet = new URLSearchParams(query);\n        if (suffixSet.has('url') || suffixSet.has('inline')) {\n          moduleCode = [\n            `import {urlLoader as loader} from 'virtual:plugin-monkey-loader'`,\n            `export default loader(...${JSON.stringify([\n              resourceName,\n              mimeType,\n            ])})`,\n          ].join(';');\n        } else if (suffixSet.has('raw')) {\n          moduleCode = [\n            `import {rawLoader as loader} from 'virtual:plugin-monkey-loader'`,\n            `export default loader(...${JSON.stringify([resourceName])})`,\n          ].join(';');\n        } else if (ext == 'json') {\n          // export name will bring side effect\n          moduleCode = [\n            `import {jsonLoader as loader} from 'virtual:plugin-monkey-loader'`,\n            `export default loader(...${JSON.stringify([resourceName])})`,\n          ].join(';');\n        } else if (ext == 'css') {\n          moduleCode = [\n            `import {cssLoader as loader} from 'virtual:plugin-monkey-loader'`,\n            `export default loader(...${JSON.stringify([resourceName])})`,\n          ].join(';');\n        } else if (viteConfig.assetsInclude(importName.split('?', 1)[0])) {\n          const mediaType = mimes[ext];\n          moduleCode = [\n            `import {urlLoader as loader} from 'virtual:plugin-monkey-loader'`,\n            `export default loader(...${JSON.stringify([\n              resourceName,\n              mediaType,\n            ])})`,\n          ].join(';');\n        }\n        if (moduleCode) {\n          if (\n            moduleCode.includes('rawLoader') ||\n            moduleCode.includes('jsonLoader') ||\n            moduleCode.includes('cssLoader')\n          ) {\n            finalOption.userscript.grant.add('GM_getResourceText');\n          } else if (moduleCode.includes('urlLoader')) {\n            finalOption.userscript.grant.add('GM_getResourceURL');\n          }\n          return miniCode(moduleCode);\n        }\n\n        throw new Error(`module: ${importName} not found loader`);\n      }\n    },\n    generateBundle() {\n      const usedModIdSet = new Set(\n        Array.from(this.getModuleIds()).map((s) => normalizePath(s)),\n      );\n      Array.from(usedModIdSet).forEach((id) => {\n        if (id.startsWith(resourceImportPrefix) && id.endsWith('\\0')) {\n          usedModIdSet.add(\n            id.substring(resourceImportPrefix.length, id.length - 1),\n          );\n        }\n      });\n      const collectResource: Record<string, string> = {};\n      Object.entries(resourceRecord).forEach(\n        ([importName, { resourceName, resourceUrl }]) => {\n          if (usedModIdSet.has(importName)) {\n            collectResource[resourceName] = resourceUrl;\n          }\n        },\n      );\n      finalOption.collectResource = collectResource;\n    },\n  };\n};\n","import type { OutputChunk, RollupOutput } from 'rollup';\nimport { build, PluginOption } from 'vite';\nimport { getSystemjsRequireUrls, systemjsTexts } from '../systemjs';\nimport {\n  transformIdentifierToTla,\n  transformTlaToIdentifier,\n} from '../topLevelAwait';\nimport type { FinalMonkeyOption } from '../types';\nimport { finalMonkeyOptionToComment } from '../userscript';\nimport { moduleExportExpressionWrapper } from '../_util';\n\nconst __entry_name = `__monkey.entry.js`;\n\n// https://github.com/vitejs/vite/blob/1df2cfcbebd95a139da7dc30aad487c81b153b45/packages/plugin-legacy/src/index.ts#L718\nconst polyfillId = '\\0vite/legacy-polyfills';\n\nconst systemJsImportMapPrefix = `user`;\n\nexport const finalBundlePlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  return {\n    name: 'monkey:finalBundle',\n    apply: 'build',\n    enforce: 'post',\n    async generateBundle(_, rawBundle) {\n      const entryChunks = (() => {\n        const polyfillChunks: OutputChunk[] = [];\n        const chunks: OutputChunk[] = [];\n        Object.values(rawBundle).forEach((chunk) => {\n          if (chunk.type == 'chunk' && chunk.isEntry) {\n            if (chunk.facadeModuleId == polyfillId) {\n              polyfillChunks.push(chunk);\n            } else {\n              chunks.push(chunk);\n            }\n          }\n        });\n        return polyfillChunks.concat(chunks);\n      })();\n\n      finalOption.hasDynamicImport = entryChunks.some(\n        (e) => e.dynamicImports.length > 0,\n      );\n\n      const buildResult = (await build({\n        logLevel: 'error',\n        configFile: false,\n        esbuild: false,\n        plugins: [\n          {\n            name: 'mokey:mock',\n            enforce: 'pre',\n            resolveId(source, importer, options) {\n              if (!importer && options.isEntry) {\n                return '\\0' + source;\n              }\n              const chunk = Object.values(rawBundle).find(\n                (chunk) =>\n                  chunk.type == 'chunk' && source.endsWith(chunk.fileName),\n              ) as OutputChunk | undefined;\n              if (chunk) {\n                return '\\0' + source;\n              }\n            },\n            async load(id) {\n              if (!id.startsWith('\\0')) return;\n\n              if (id.endsWith(__entry_name)) {\n                return entryChunks\n                  .map((a) => `import ${JSON.stringify(`./${a.fileName}`)};`)\n                  .join('\\n');\n              }\n              const [k, chunk] =\n                Object.entries(rawBundle).find(([k, chunk]) =>\n                  id.endsWith(chunk.fileName),\n                ) ?? [];\n              if (chunk && chunk.type == 'chunk' && k) {\n                delete rawBundle[k];\n                if (!finalOption.hasDynamicImport) {\n                  const ch = transformTlaToIdentifier(this, chunk);\n                  if (ch) return ch;\n                }\n                return {\n                  code: chunk.code,\n                  map: chunk.map,\n                };\n              }\n            },\n            generateBundle(_, iifeBundle) {\n              if (finalOption.hasDynamicImport) {\n                return;\n              }\n              Object.entries(iifeBundle).forEach(([k, chunk]) => {\n                transformIdentifierToTla(this, chunk);\n              });\n            },\n          },\n        ],\n        build: {\n          write: false,\n          minify: false,\n          target: 'esnext',\n          rollupOptions: {\n            external(source) {\n              return source in finalOption.globalsPkg2VarName;\n            },\n            output: {\n              globals: finalOption.globalsPkg2VarName,\n            },\n          },\n          lib: {\n            entry: __entry_name,\n            formats: [finalOption.hasDynamicImport ? 'system' : 'iife'] as any,\n            name: finalOption.hasDynamicImport ? undefined : '__expose__',\n            fileName: () => `__entry.js`,\n          },\n        },\n      })) as RollupOutput[];\n\n      const finalBundle = Object.assign({}, rawBundle, buildResult[0].output);\n      let finalJsCode = ``;\n      if (finalOption.hasDynamicImport) {\n        const systemJsModules: string[] = [];\n        let entryName = '';\n        Object.entries(finalBundle).forEach(([k, chunk]) => {\n          if (chunk.type == 'chunk') {\n            const name = JSON.stringify(`./` + chunk.fileName);\n            systemJsModules.push(\n              chunk.code\n                .trimStart()\n                .replace(/^System\\.register\\(/, `System.register(${name}, `),\n            );\n            if (chunk.isEntry) {\n              entryName = name;\n            }\n          }\n        });\n        systemJsModules.push(`System.import(${entryName}, \"./\");`);\n        finalJsCode = systemJsModules.join('\\n');\n        const usedModuleIds = Array.from(this.getModuleIds()).filter(\n          (d) => d in finalOption.globalsPkg2VarName,\n        );\n        // {vue:'xxx:vue'}\n        const importsMap = usedModuleIds.reduce(\n          (p: Record<string, string>, c) => {\n            p[c] = `${systemJsImportMapPrefix}:${c}`;\n            return p;\n          },\n          {},\n        );\n        // inject SystemJs external globals\n        finalJsCode = [\n          Object.keys(importsMap).length > 0\n            ? `System.addImportMap({ imports: ${JSON.stringify(importsMap)} });`\n            : ``,\n          ...usedModuleIds.map(\n            (id) =>\n              `System.set(${JSON.stringify(\n                `${systemJsImportMapPrefix}:${id}`,\n              )}, ${moduleExportExpressionWrapper(\n                finalOption.globalsPkg2VarName[id],\n              )});`,\n          ),\n          '\\n' + finalJsCode,\n        ]\n          .filter((s) => s)\n          .join('\\n');\n\n        if (finalOption.hasDynamicImport) {\n          if (typeof finalOption.systemjs == 'function') {\n            finalOption.collectRequireUrls.push(\n              ...getSystemjsRequireUrls(finalOption.systemjs),\n            );\n          } else {\n            finalJsCode =\n              (await systemjsTexts.value).join('\\n') + '\\n' + finalJsCode;\n          }\n        }\n      } else {\n        // use iife\n        Object.entries(finalBundle).forEach(([k, chunk]) => {\n          if (chunk.type == 'chunk' && chunk.isEntry) {\n            finalJsCode = chunk.code;\n          }\n        });\n      }\n\n      const bannerCode = [\n        await finalMonkeyOptionToComment(finalOption),\n        finalOption.injectCssCode,\n      ]\n        .filter((s) => s)\n        .map((s) => s + `\\n\\n`)\n        .join(``);\n\n      // wrap, @require, @resouse will make map error. This requires developers to manually pass the extra offset in the outside\n      // The offset of different userscript engines is different\n      // let { offset, sourceRoot } = finalPluginOption.build.sourcemap;\n      // for (const char of bannerCode) {\n      //   if (char == '\\n') {\n      //     offset++;\n      //   }\n      // }\n      // if (offset < 0) {\n      //   offset = 0;\n      // }\n      // const { map } = chunk;\n      // if (map) {\n      //   map.mappings = ';'.repeat(offset) + map.mappings;\n\n      //   let relativeFileList = map.sources\n      //     .map((filepath, i) => ({ filepath, i }))\n      //     .filter(({ filepath }) => !path.isAbsolute(filepath));\n      //   while (\n      //     relativeFileList.every(({ filepath }) => filepath.startsWith('../'))\n      //   ) {\n      //     relativeFileList.forEach((f) => {\n      //       f.filepath = f.filepath.substring(3);\n      //     });\n      //   }\n      //   let relativeMaxNum = 0;\n      //   relativeFileList.forEach(({ filepath }) => {\n      //     let n = 0;\n      //     while (filepath.substring(n * 3).startsWith('../')) {\n      //       n++;\n      //     }\n      //     if (relativeMaxNum < n) {\n      //       relativeMaxNum = n;\n      //     }\n      //   });\n      //   const prefix = '-/'.repeat(relativeMaxNum);\n      //   relativeFileList.forEach(({ filepath, i }) => {\n      //     map.sources[i] = prefix + filepath;\n      //   });\n      //   Reflect.set(map, 'sourceRoot', sourceRoot);\n      // }\n      finalJsCode = bannerCode + finalJsCode;\n      this.emitFile({\n        type: 'asset',\n        fileName: finalOption.build.fileName,\n        source: finalJsCode,\n      });\n\n      const { metaFileName, fileName } = finalOption.build;\n      if (metaFileName) {\n        this.emitFile({\n          type: 'asset',\n          fileName: metaFileName(fileName),\n          source: await finalMonkeyOptionToComment(finalOption),\n        });\n      }\n    },\n  };\n};\n","import module from 'node:module';\nimport type systemjsPkgT from 'systemjs/package.json';\nimport { Mod2UrlFn2 } from './types';\nimport fs from 'node:fs/promises';\nimport { lazyValue } from './_lazy';\nimport { dataUrl } from './util';\n\nconst _require = module.createRequire(import.meta.url);\n\nconst systemjsPkg: typeof systemjsPkgT = _require(`systemjs/package.json`);\n\nconst systemjsSubPaths = [\n  'dist/system.min.js',\n  'dist/extras/named-register.min.js',\n];\n\n// https://github.com/systemjs/systemjs/blob/main/docs/api.md#systemconstructor\nconst customSystemInstanceCode = `;(typeof System!='undefined')&&(System=new System.constructor());`;\n\nconst systemjsAbsolutePaths = systemjsSubPaths.map((s) => {\n  return _require.resolve(`systemjs/` + s);\n});\n\nexport const systemjsTexts = lazyValue(() => {\n  return Promise.all(\n    systemjsAbsolutePaths\n      .map((s) =>\n        fs.readFile(s, 'utf-8').then((s) =>\n          s\n            .trim()\n            .replace(/^\\/\\*[\\s\\S]*?\\*\\//, '')\n            .replace(/\\/\\/.*map$/, '')\n            .trim(),\n        ),\n      )\n      .concat([Promise.resolve(customSystemInstanceCode)]),\n  );\n});\n\nexport const getSystemjsRequireUrls = (fn: Mod2UrlFn2) => {\n  return systemjsSubPaths\n    .map((p) => {\n      return fn(systemjsPkg.version, systemjsPkg.name, p, p);\n    })\n    .concat([dataUrl(customSystemInstanceCode)]);\n};\n","import type { InlinePreset } from 'unimport';\nimport { transformWithEsbuild } from 'vite';\n\n/**\n * transform function and parameter to iife code then mini code then transform code to data url string\n *\n * this tool function is used to make umd-cdn and iife-cdn work normally, such as element-plus and vue\n *\n * @example\n * // this example comes form https://github.com/lisonge/vite-plugin-monkey/blob/main/playground/ex-vue-demi/vite.config.ts\n * const externalGlobals = [\n *   [\n *     'vue',\n *     cdn\n *       .jsdelivr('Vue', 'dist/vue.global.prod.js')\n *       .concat('https://unpkg.com/vue-demi@latest/lib/index.iife.js')\n *       .concat(\n *         await util.fn2dataUrl(() => {\n *           // \\@ts-ignore\n *           window.Vue = Vue; // work with element-plus\n *         }),\n *       ),\n *   ],\n *   ['pinia', cdn.jsdelivr('Pinia', 'dist/pinia.iife.prod.js')],\n *   ['element-plus', cdn.jsdelivr('ElementPlus', 'dist/index.full.min.js')],\n * ];\n */\nexport const fn2dataUrl = async <T extends (...args: any[]) => any>(\n  fn: T,\n  ...args: Parameters<T>\n) => {\n  return (\n    'data:application/javascript,' +\n    encodeURIComponent(\n      (\n        await transformWithEsbuild(\n          `;(${fn})(...${JSON.stringify(args)})`,\n          'any_name.js',\n          {\n            minify: true,\n            sourcemap: false,\n            legalComments: 'none',\n          },\n        )\n      ).code.trimEnd(),\n    )\n  );\n};\n\n/**\n * string -> javascript data url\n */\nexport function dataUrl(code: string): string;\n/**\n * function and it parameters -> iife -> mini_iife -> javascript data url\n */\nexport function dataUrl<T extends (...args: any[]) => any>(\n  fn: T,\n  ...args: Parameters<T>\n): Promise<string>;\nexport function dataUrl(p0: any, ...args: any[]): string | Promise<string> {\n  if (typeof p0 == 'string') {\n    return `data:application/javascript,` + encodeURIComponent(p0);\n  }\n  return fn2dataUrl(p0, ...args);\n}\n\n/**\n * GM api preset when you use unimport/unplugin-auto-import\n *\n * Note, there is not comment in unimport.d.ts/auto-imports.d.ts file\n */\nexport const unimportPreset: InlinePreset = {\n  from: 'vite-plugin-monkey/dist/client',\n  imports: [\n    'GM',\n    'GM_addElement',\n    'GM_addStyle',\n    'GM_addValueChangeListener',\n    'GM_cookie',\n    'GM_deleteValue',\n    'GM_download',\n    'GM_getResourceText',\n    'GM_getResourceURL',\n    'GM_getTab',\n    'GM_getTabs',\n    'GM_getValue',\n    'GM_info',\n    'GM_listValues',\n    'GM_log',\n    'GM_notification',\n    'GM_openInTab',\n    'GM_registerMenuCommand',\n    'GM_removeValueChangeListener',\n    'GM_saveTab',\n    'GM_setClipboard',\n    'GM_setValue',\n    'GM_unregisterMenuCommand',\n    'GM_xmlhttpRequest',\n    'GM_webRequest',\n    'unsafeWindow',\n    'monkeyWindow',\n  ],\n};\n","import type { Node as AcornNode } from 'acorn';\nimport * as acornWalk from 'acorn-walk';\nimport MagicString from 'magic-string';\nimport type { OutputAsset, OutputChunk, PluginContext } from 'rollup';\n\ntype CallAcornNode = AcornNode & {\n  callee: AcornNode & { name: string };\n  arguments: AcornNode[];\n};\n\nconst awaitOffset = `await`.length;\nconst tlaIdentifier = `__TOP_LEVEL_AWAIT__`;\n\nexport const transformTlaToIdentifier = (\n  context: PluginContext,\n  chunk: OutputAsset | OutputChunk,\n) => {\n  if (chunk.type == 'chunk') {\n    const code = chunk.code;\n    if (!code.includes(`await`)) {\n      return;\n    }\n    const ast = context.parse(code);\n    const tlaNodes: AcornNode[] = [];\n    const tlaForOfNodes: AcornNode[] = [];\n    acornWalk.simple(\n      ast,\n      {\n        AwaitExpression(node) {\n          // top level await\n          tlaNodes.push(node);\n        },\n        // @ts-ignore\n        ForOfStatement(node: AcornNode & { await: boolean }) {\n          if (node.await === true) {\n            tlaForOfNodes.push(node);\n          }\n        },\n      },\n      { ...acornWalk.base, Function: () => {} },\n    );\n    if (tlaNodes.length > 0 || tlaForOfNodes.length > 0) {\n      const ms = new MagicString(code);\n      tlaNodes.forEach((node) => {\n        // await xxx -> await (xxx)\n        ms.appendLeft(node.start + awaitOffset, `(`);\n        ms.appendRight(node.end, `)`);\n\n        // await (xxx) -> __topLevelAwait__ (xxx)\n        ms.update(node.start, node.start + awaitOffset, tlaIdentifier);\n      });\n      tlaForOfNodes.forEach((node) => {\n        // for await(const x of xxx){} -> __topLevelAwait__ ((async()=>{ /*start*/for await(const x of xxx){}/*end*/  })());\n        ms.appendLeft(node.start, `${tlaIdentifier}((async()=>{`);\n        ms.appendRight(node.end, `})());`);\n      });\n      return {\n        code: ms.toString(),\n        map: ms.generateMap(),\n      };\n    }\n  }\n};\n\nexport const transformIdentifierToTla = (\n  context: PluginContext,\n  chunk: OutputAsset | OutputChunk,\n) => {\n  if (chunk.type == 'chunk') {\n    if (!chunk.code.includes(tlaIdentifier)) {\n      return;\n    }\n\n    const base = Object.keys(acornWalk.base).reduce<\n      Record<string, acornWalk.RecursiveWalkerFn<any>>\n    >((p, key) => {\n      if (key in p) return p;\n      p[key] = (node, state, callback) => {\n        if (\n          chunk.code.substring(node.start, node.end).includes(tlaIdentifier)\n        ) {\n          return acornWalk.base[key](node, state, callback);\n        }\n      };\n      return p;\n    }, {});\n    const ast = context.parse(chunk.code);\n    const tlaCallNodes: CallAcornNode[] = [];\n    const topFnNodes: AcornNode[] = [];\n    acornWalk.simple(\n      ast,\n      {\n        // @ts-ignore\n        CallExpression(node: CallAcornNode) {\n          // top level await\n          if (\n            node.callee?.type === `Identifier` &&\n            node.callee?.name === tlaIdentifier\n          ) {\n            tlaCallNodes.push(node);\n          }\n        },\n      },\n      {\n        ...base,\n        Function: (node, state, callback) => {\n          if (topFnNodes.length == 0) {\n            topFnNodes.push(node);\n          }\n          if (\n            chunk.code.substring(node.start, node.end).includes(tlaIdentifier)\n          ) {\n            return acornWalk.base.Function(node, state, callback);\n          }\n        },\n      },\n    );\n    if (tlaCallNodes.length > 0 || topFnNodes.length > 0) {\n      const ms = new MagicString(chunk.code, {});\n      tlaCallNodes.forEach((node) => {\n        const callee = node.callee;\n        const [argument] = node.arguments as AcornNode[];\n        ms.update(callee.start, callee.end, '');\n        ms.update(callee.end, argument.start, `(await\\x20`);\n      });\n      topFnNodes.forEach((node) => {\n        ms.appendLeft(node.start, `async\\x20`);\n      });\n      chunk.code = ms.toString();\n      // TODO sourcemap\n      // https://github.com/keik/merge-source-map\n      if (chunk.map) {\n        chunk.map;\n      }\n    }\n  }\n};\n","import fs from 'node:fs/promises';\nimport path from 'node:path';\nimport { normalizePath, PluginOption, ResolvedConfig } from 'vite';\nimport { fn2string, redirectFn } from '../inject_template';\nimport type { FinalMonkeyOption } from '../types';\n\nasync function* walk(dirPath: string) {\n  const pathnameList = (await fs.readdir(dirPath)).map((s) =>\n    path.join(dirPath, s),\n  );\n  while (pathnameList.length > 0) {\n    const pathname = pathnameList.pop()!;\n    const state = await fs.lstat(pathname);\n    if (state.isFile()) {\n      yield pathname;\n    } else if (state.isDirectory()) {\n      pathnameList.push(\n        ...(await fs.readdir(pathname)).map((s) => path.join(pathname, s)),\n      );\n    }\n  }\n}\n\nexport const perviewPlugin = (finalOption: FinalMonkeyOption): PluginOption => {\n  let viteConfig: ResolvedConfig;\n  return {\n    name: 'monkey:perview',\n    apply: 'serve',\n    configResolved(config) {\n      viteConfig = config;\n    },\n    async configurePreviewServer(server) {\n      server.middlewares.use(async (req, res, next) => {\n        if (['/', '/index.html'].includes((req.url ?? '').split('?')[0])) {\n          const distDirPath = path.join(process.cwd(), viteConfig.build.outDir);\n          for await (const pathname of walk(distDirPath)) {\n            if (pathname.endsWith('.user.js')) {\n              const fileName = normalizePath(\n                path.relative(distDirPath, pathname),\n              );\n              Object.entries({\n                'content-type': 'text/html; charset=utf-8',\n              }).forEach(([k, v]) => {\n                res.setHeader(k, String(v));\n              });\n              res.end(\n                `<script type=\"module\" data-source=\"vite-plugin-monkey\">${fn2string(\n                  redirectFn,\n                  '/' + fileName,\n                )}</script>`,\n              );\n              return;\n            }\n          }\n        }\n        next();\n      });\n    },\n  };\n};\n","import { PluginOption, ResolvedConfig, transformWithEsbuild } from 'vite';\nimport { cssInjectFn, fn2string } from '../inject_template';\nimport type { FinalMonkeyOption } from '../types';\nimport { getFinalTarget, miniCode } from '../_util';\n\nexport const collectCssPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  let viteConfig: ResolvedConfig;\n\n  return {\n    name: 'monkey:collectCss',\n    apply: 'build',\n    enforce: 'post',\n    configResolved(config) {\n      viteConfig = config;\n    },\n    async generateBundle(_, esmBundle) {\n      const cssBundleList = Object.entries(esmBundle).filter(([k]) =>\n        k.endsWith('.css'),\n      );\n      const cssList: string[] = [];\n      cssBundleList.forEach(([k, v]) => {\n        if (v.type == 'asset') {\n          cssList.push(v.source.toString());\n          delete esmBundle[k];\n        }\n      });\n      if (cssList.length > 0) {\n        let css = cssList.join('');\n        if (!viteConfig.build.minify && finalOption.build.minifyCss) {\n          const { cssTarget, target } = viteConfig.build;\n          const finalCssTarget = getFinalTarget(cssTarget || target || []);\n          css = (\n            await transformWithEsbuild(css, 'any_name.css', {\n              sourcemap: false,\n              legalComments: 'none',\n              minify: true,\n              target: finalCssTarget,\n            })\n          ).code.trimEnd();\n        }\n        finalOption.injectCssCode = await miniCode(\n          fn2string(cssInjectFn, '\\x20' + css + '\\x20'),\n          // use \\x20 to compat unocss, see https://github.com/lisonge/vite-plugin-monkey/issues/45\n          // TODO check the order of plugin-monkey is last in vite plugin list, if not, logger warn message\n          'js',\n        );\n      }\n    },\n  };\n};\n","import type { PluginOption } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\n\nexport const redirectClientPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  return {\n    name: 'monkey:redirectClient',\n    enforce: 'pre',\n    apply: 'build',\n    resolveId(source, importer, options) {\n      if (source == 'vite-plugin-monkey/dist/client') {\n        return this.resolve(\n          'vite-plugin-monkey/dist/native',\n          importer,\n          options,\n        );\n      }\n    },\n  };\n};\n","import { PluginOption, ResolvedConfig, transformWithEsbuild } from 'vite';\nimport type { FinalMonkeyOption } from '../types';\nimport fs from 'node:fs/promises';\n\n// https://github.com/vitejs/vite/blob/42e0d6af67743841bd38ed504cb8cbaaafb6313f/packages/vite/src/node/plugins/asset.ts#L327\n\nexport const inlinesAssetPlugin = (\n  finalOption: FinalMonkeyOption,\n): PluginOption => {\n  let viteConfig: ResolvedConfig;\n  return {\n    name: 'monkey:inlinesAsset',\n    enforce: 'post',\n    apply: 'build',\n    async configResolved(resolvedConfig) {\n      viteConfig = resolvedConfig;\n    },\n    async transform(code, id) {\n      if (\n        viteConfig.assetsInclude(id) &&\n        [`.svg`, `.svg?inline`, `.svg?url`].some((s) => id.endsWith(s)) &&\n        code.includes(`__VITE_ASSET__`)\n      ) {\n        const base64Text = (await fs.readFile(id.split('?')[0])).toString(\n          'base64',\n        );\n        return `export default ${JSON.stringify(\n          `data:image/svg+xml;base64,` + base64Text,\n        )}`;\n      }\n    },\n    generateBundle(opts, bundle) {\n      for (const key in bundle) {\n        if ([`.svg`].some((s) => key.endsWith(s))) {\n          delete bundle[key];\n        }\n      }\n    },\n  };\n};\n","import { virtualHtmlPlugin } from './virtualHtml';\nimport { fixViteAssetPlugin } from './fixViteAsset';\nimport { fixViteClientPlugin } from './fixViteClient';\nimport { serverPlugin } from './server';\nimport { autoGrantPlugin } from './autoGrant';\nimport { externalGlobalsPlugin } from './externalGlobals';\nimport { externalLoaderPlugin } from './externalLoader';\nimport { externalResourcePlugin } from './externalResource';\nimport { finalBundlePlugin } from './finalBundle';\nimport { perviewPlugin } from './perview';\nimport { collectCssPlugin } from './collectCss';\nimport { redirectClientPlugin } from './redirectClient';\nimport { inlinesAssetPlugin } from './inlinesAsset';\n\nconst monkeyPluginList = [\n  // only serve\n  virtualHtmlPlugin,\n  fixViteAssetPlugin,\n  fixViteClientPlugin,\n  serverPlugin,\n\n  // only build pre\n  redirectClientPlugin,\n  externalLoaderPlugin,\n  externalResourcePlugin,\n  externalGlobalsPlugin,\n\n  // only build post\n  autoGrantPlugin,\n  inlinesAssetPlugin,\n  collectCssPlugin,\n\n  // only build, final build\n  finalBundlePlugin,\n\n  // only preview\n  perviewPlugin,\n];\nexport default monkeyPluginList;\n"],"mappings":"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","names":["pc","path","fs","build","name","require","import_promises","import_node_path","import_vite","import_node_path","import_picocolors","logger","spawn","colors","path","open","require","description","maxLen","detectPort","htmlText","path","fs","import_vite","import_vite","import_vite","import_vite","import_vite","import_node_module","import_promises","import_vite","module","fs","s","MagicString","base","chunk","k","_","import_promises","import_node_path","import_vite","fs","path","import_vite","import_promises","fs"]}